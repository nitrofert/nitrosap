<div class="grid">
	<div class="col-12 md:col-12 ">
		<div class="card p-fluid">
            <!--mensaje error o confirmación-->
            <p-messages [(value)]="messageForm"></p-messages>
            <!-- fin mensaje error o confirmacion -->
			<h5>Editar usuario</h5>
            <!--<form (ngSubmit)="submit()">>-->
            <!--<ng-template pTemplate="content">-->
                <div class="grid">
                    <div class="field col">
                        <label htmlFor="fullname">Nombre completo</label>
                        <input pInputText
                               [(ngModel)] ="fullname"
                               id="fullname" 
                               name="fullname" 
                               type="text" 
                               required 
                               autofocus 
                               [ngClass]="{'ng-invalid ng-dirty' : submitted && !fullname}"/>
                    </div>
        
                    <div class="field col">
                        <label htmlFor="email">Email</label>
                        <input pInputText
                               [(ngModel)] = "email"
                               id="email" 
                               name="email" 
                               type="email"
                               required 
                               
                               [ngClass]="{'ng-invalid ng-dirty' : submitted && !email}" />
                    </div>
                </div>
                
                <div class="grid">
                    <div class="field col">
                        <label htmlFor="status">Estado</label>
                        
                        <p-dropdown [options]="estados" 
                                    optionLabel="name"
                                    optionValue="code" 
                                    [(ngModel)]="status"
                                    id="status"
                                    name="status"
                                    placeholder="Seleccione el estado"
                                    [required]="true"                        
                                    [ngClass]="{'ng-invalid ng-dirty' : submitted && !status}"></p-dropdown>
                    </div>
                </div>
                
                <div class="grid">
                    <div class="field col">
                        <label htmlFor="codusersap">Usuario SAP</label>
                        <input pInputText
                               [(ngModel)] ="codusersap"
                               id="codusersap" 
                               name="codusersap" 
                               type="text" 
                               required 
                               autofocus 
                               [ngClass]="{'ng-invalid ng-dirty' : submitted && !codusersap}"/>
                    </div>
        
                    <div class="field col">
                        <label htmlFor="username">Usuario portal</label>
                        <input pInputText
                               [(ngModel)] ="username"
                               id="username" 
                               name="username" 
                               type="text" 
                               required 
                               autofocus 
                               [ngClass]="{'ng-invalid ng-dirty' : submitted && !username}"/>
                    </div>
                </div>
                
                <div class="grid">
                    <div class="field col">
                        <label htmlFor="password">Contraseña</label>
                        <p-password [(ngModel)]="password"
                                    id="password" 
                                    name="password"
                                    
        
                        ></p-password>
                    
                    </div>
        
                    <div class="field col">
                        <label htmlFor="password2">Repetir contraseña</label>
                        <p-password [(ngModel)]="password2"
                                    id="password2" 
                                    name="password2"
                                    [ngClass]="{'ng-invalid ng-dirty' : submitted && password && !password2}"
        
                        ></p-password>
                    
                    </div>
                </div>
    
                
            
            <!--</ng-template>-->
            <!--<ng-template pTemplate="footer">-->
            <div class="grid">
                <div class="col">
                    <button pButton label="Guardar" (click)="saveUser()"  class="p-button-outlined mb-2 p-button-success" icon="pi pi-save"></button>
                </div>
                
            </div>

            
           

            


            <p-tabView>
                <p-tabPanel header="Perfiles" leftIcon="pi pi-id-card" >
                   
        
                    <div class="grid text-center">
                        <div *ngFor="let perfil of perfiles" class="col-4">
                            <div class="font-bold">{{perfil.perfil}}</div>
                            <div>
                                <p-selectButton [options]="opciones" 
                                                    [(ngModel)]="perfil.perfil_user" 
                                                    optionLabel="label" 
                                                    optionValue="value"
                                                    (onChange)="setPerfilUser(perfil.perfil_user,perfil.id)"></p-selectButton>
                            </div>
                        </div>
                        
                    </div>
        
                </p-tabPanel>
                <p-tabPanel header="Empresas" leftIcon="pi pi-building">
                    <div class="grid text-center">
                        <div *ngFor="let company of companies" class="col-4">
                            <div class="font-bold">{{company.companyname}}</div>
                            <div>
                                <p-selectButton [options]="opciones" 
                                                    [(ngModel)]="company.company_access" 
                                                    optionLabel="label" 
                                                    optionValue="value"
                                                    (onChange)="setAccess(company.company_access,company.id)"></p-selectButton>
                            </div>
                        </div>
                        
                    </div>
                </p-tabPanel>
                <p-tabPanel header="Areas">
                    <div class="grid ">
                            <div class="card">
                                <div class="field col">
                                    <p-table #dt1 
                                    [value]="areas_user" 
                                    dataKey="id" 
                                    [rows]="10" 
                                    [loading]="loading" 
                                    [rowHover]="true" 
                                    styleClass="p-datatable-gridlines " 
                                    [paginator]="true" 
                                    [globalFilterFields]="['fullname','email','username','codusersap']" 
                                    selectionMode="multiple" 
                                    [(selection)]="selectedAreasUser" 
                                    responsiveLayout="scroll">

                                <ng-template pTemplate="caption">
                                    <div class="flex justify-content-between flex-column sm:flex-row">
                                        <div class="grid">
                                            
                                        <button pButton  class="p-button-outlined mb-2 mr-2" icon="pi pi-filter-slash" (click)="cleart(dt1)"></button>
                                        <button pButton  class="p-button-outlined mb-2 p-button-success mr-2" icon="pi pi-plus" (click)="newArea()"></button>
                                        <button pButton  class="p-button-outlined mb-2 p-button-danger mr-2" icon="pi pi-trash" (click)="deleteArea()" [disabled]="!selectedAreasUser || selectedAreasUser.length==0"></button>
                                        <!--<button pButton label="Empresas" class="p-button-outlined mb-2 p-button-warning" icon="pi pi-building" (click)="companyUser()" [disabled]="!selectedUser || selectedUser.length!=1"></button>
                                        <button pButton label="Perfiles" class="p-button-outlined mb-2 p-button-help" icon="pi pi-id-card" (click)="perfilUser()" [disabled]="!selectedUser || selectedUser.length!=1"></button>-->
                                        </div>
                                        
                
                                        <span class="p-input-icon-left mb-2">
                                            <i class="pi pi-search"></i>
                                            <input pInputText type="text" #filter (input)="onGlobalFilter(dt1, $event)" placeholder="Buscar por palabra clave" class="w-full"/>
                                        </span>
                                    </div>
                                </ng-template>
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th style="width: 3rem">
                                            <!--<p-tableHeaderCheckbox></p-tableHeaderCheckbox>-->
                                        </th>
                                        <th>
                                            <div class="flex justify-content-between align-items-center">
                                                Area 
                                                <p-columnFilter type="text" field="fullname" display="menu" placeholder="Buscar por Area"></p-columnFilter>
                                            </div>
                                        </th>
                                      
                                        
                                        
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-areasusuario>
                                    <tr>
                                        <td>
                                            <p-tableCheckbox [value]="areasusuario"></p-tableCheckbox>
                                        </td>
                                        <td style="min-width: 100%;">
                                            {{ areasusuario.area }}
                                        </td>
                                     
                                       
                            
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="2">No se econtraron areas asociadas al usuario.</td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="loadingbody">
                                    <tr>
                                        <td colspan="2">Cargando areas usuario. Por favor espere</td>
                                    </tr>
                                </ng-template>
                            </p-table>
                                </div>
                               
                            </div>
                    </div>
                </p-tabPanel>
                <p-tabPanel header="Dependencias">
                    Dependencias
                </p-tabPanel>
            </p-tabView>

           

            
                
            <!--</ng-template>-->
                
            
        <!--</form>-->

		</div>
    </div>
</div>


