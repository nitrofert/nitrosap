<app-breadcrumb [urlBreadCrumb]="urlBreadCrumb"></app-breadcrumb>
<p-toast></p-toast>
<!-- CAbecera calculadora-->
<div class="grid">
    <div class="col-12">
        <div class="card p-fluid">
            
            <div class="grid">
                <div class="field col">
                    <label for="fechaRequerida">Fecha semana</label>
                    <p-calendar [(ngModel)]="fecha" 
                                [showIcon]="true" 
                                inputId="fechaRequerida" 
                                [required]="true"
                                styleClass="w-full"
                                (onSelect)="calcularSemana()"
                                [disabled]="editarCalculo" 
                                [ngClass]="{'ng-invalid ng-dirty' : envioForm && !fecha}">
                    </p-calendar>
                </div>
                <div class="field col">
                    <label for="nombreCuenta">Semana Año</label>
                            <input type="text" 
                                    pInputText 
                                    [(ngModel)]="semanaAnio" 
                                    id="nombreCuenta" 
                                    disabled
                                    class="w-full"
                                    [ngClass]="{'ng-invalid ng-dirty' : envioForm && !fecha}">
                </div>
                <div class="field col">
                    <label for="nombreCuenta">Semana mes</label>
                            <input type="text" 
                                    pInputText 
                                    [(ngModel)]="semanaMes" 
                                    id="nombreCuenta" 
                                    disabled
                                    class="w-full"
                                    [ngClass]="{'ng-invalid ng-dirty' : envioForm && !fecha}">
                </div>
            </div>

            <div class="grid">

                <div class="field col">
                    <label for="nombreCuenta">TRM dia</label>
                    <input type="text" 
                            pInputText 
                            [(ngModel)]="trm_dia" 
                            id="nombreCuenta" 
                            disabled
                            class="w-full"
                            [ngClass]="{'ng-invalid ng-dirty' : envioForm && !trm_dia}">
                </div>
                <div class="field col">
                    <label for="nombreCuenta">Moneda calculo</label>
                    <p-dropdown [options]="monedas" 
                                optionLabel="Currency" 
                                [(ngModel)]="moneda" 
                                id="moneda" 
                                name="moneda" 
                                [required]="true"
                                [disabled]="editarCalculo" 
                                (onChange)="SeleccionarMoneda()">
                    </p-dropdown>
                </div>

                <div class="field col">
                    <label for="nombreCuenta">TRM moneda</label>
                    <input type="text" 
                            pInputText 
                            [(ngModel)]="trm_moneda" 
                            id="nombreCuenta" 
                            disabled
                            class="w-full"
                            [ngClass]="{'ng-invalid ng-dirty' : envioForm && !trm_dia}">
                </div>
                
            </div>

            <div class="grid">
                <div class="field col">
                    <label for="nombreCuenta">Categorias</label>
                    <p-dropdown [options]="categoriasItemPT" 
                                optionLabel="label" 
                                [(ngModel)]="categoriaItemsPT" 
                                id="categoriaItemsPT" 
                                name="categoriaItemsPT" 
                                [required]="true"
                                [disabled]="editarCalculo"
                                [showClear]="true" 
                                (onClear)="clearCategoria()"
                                (onChange)="SeleccionarCategoria()">
                    </p-dropdown>
                </div>
            </div>

            <div class="grid">
                <div class="field col">
                    <label for="itemCode">Código ítem</label>
                    <p-autoComplete *ngIf="optionSelectItemPT" 
                                    [(ngModel)]="item" 
                                    [showEmptyMessage]="true" 
                                    [suggestions]="itemsFiltrados"
                                    (completeMethod)="filtrarItems($event)" 
                                    field="label" 
                                    [minLength]="1" 
                                    [delay]="1000"
                                    [multiple]="true"
                                    (onSelect)="SeleccionarItem()"
                                    (onClear)="clearItem()" 
                                    [showClear]="true" 
                                    inputStyleClass="w-full" 
                                    styleClass="w-full" 
                                    inputId="itemCode" [autofocus]="true"
                                    panelStyleClass="text-sm sm:ml-2" 
                                    placeholder="Escriba el código o nombre del ítem para buscar"
                                    [disabled]="editarCalculo || optionSelectItemPT" 
                                    [ngClass]="{'ng-invalid ng-dirty' :  envioForm && item==''}">
    
                        <ng-template let-item pTemplate="item">
                            <div>{{item.ItemCode}} - {{item.ItemName}}</div>
                        </ng-template>
                       
    
                    </p-autoComplete>

                    <p-autoComplete *ngIf="!optionSelectItemPT" 
                                    [(ngModel)]="item" 
                                    [showEmptyMessage]="true" 
                                    [suggestions]="itemsFiltrados"
                                    (completeMethod)="filtrarItems($event)" 
                                    field="label" 
                                    [minLength]="1" 
                                    [delay]="1000"
                                    [multiple]="false"
                                    (onSelect)="SeleccionarItem()"
                                    (onClear)="clearItem()" 
                                    [showClear]="true" 
                                    inputStyleClass="w-full" 
                                    styleClass="w-full" 
                                    inputId="itemCode" [autofocus]="true"
                                    panelStyleClass="text-sm sm:ml-2" 
                                    placeholder="Escriba el código o nombre del ítem para buscar"
                                    [disabled]="editarCalculo" 
                                    [ngClass]="{'ng-invalid ng-dirty' :  envioForm && item==''}">
    
                        <ng-template let-item pTemplate="item">
                            <div>{{item.ItemCode}} - {{item.ItemName}}</div>
                        </ng-template>
                       
    
                    </p-autoComplete>
                </div>
            </div>

            <div class="grid">
                <div class="field col">
                    <label for="nombreCuenta">Observación</label>
                    <input type="text" 
                            pInputText 
                            [(ngModel)]="observacion" 
                            id="nombreCuenta" 
                            [disabled]="editarCalculo"         
                            class="w-full">
                </div>
            </div>

            
        </div>
    </div>
</div>
<!-- Fin cabecera calculadora -->

<!--  Calculadora de precios -->

<div class="card">
    <!--  Precio referencia, precio gerente, vendedor y de lista-->
    <div class="grid">
        <div class="field col">
            <label for="precioBase">Precio base</label>
            
                <p-dropdown [options]="opcionesPrecioBase" 
                        optionLabel="label" 
                        id="precioBase"
                        [(ngModel)]="precioBase" 
                        [required]="true"
                        styleClass="w-full"
                        [disabled]="editarCalculo"
                        (onChange)="SeleccionarPrecioBase()">
            </p-dropdown>
            
            
        </div>
        
        <div class="field col">
                
                <label for="precioGerente">Precio gerente</label>
                <div>
                    <input type="number" 
                            pInputText 
                            [(ngModel)]="precioGerente" 
                            id="precioGerente" 
                            (input)="cambiarPrecioGerente(precioGerente)"
                            class="w-8"
                            [disabled]="optionSelectItemPT"
                            [ngClass]="{'ng-invalid ng-dirty' : envioForm && !fecha}">
                    
                    <input type="number" 
                           pInputText id="prcGerente" 
                           [(ngModel)]="prcGerente"
                           [disabled]="true"  
                           (input)="cambiarPrcGerente(prcGerente)"
                           class="w-4"/>

                    <p-slider [(ngModel)]="prcGerente" 
                              [min]="-100" 
                              [max]="100"
                              [disabled]="true"
                              (onSlideEnd)="cambioPrcGerente($event)">
                    </p-slider>
                </div>
                    
        </div>
        <div class="field col">
            <label for="precioVendedor">Precio vendedor</label>
                <div>
                    <input type="number" 
                            pInputText 
                            [(ngModel)]="precioVendedor" 
                            id="precioVendedor" 
                            (change)="cambiarPrecioVendedor(precioVendedor)"
                            class="w-8"
                            [disabled]="editarCalculo || optionSelectItemPT"
                            [ngClass]="{'ng-invalid ng-dirty' : envioForm && !fecha}">
                    
                    <input type="number" 
                            pInputText id="prcGerente" 
                            [(ngModel)]="prcVendedor"
                            [disabled]="editarCalculo || optionSelectItemPT"  
                            (input)="cambiarPrcVendedor(prcVendedor)"
                            class="w-4"/>
 
                     <p-slider [(ngModel)]="prcVendedor" 
                               [min]="-100" 
                               [max]="100"
                               [disabled]="editarCalculo || optionSelectItemPT"
                               (onSlideEnd)="cambioPrcVendedor($event)">
                     </p-slider>
                </div>
                    
        </div>
        <div class="field col">
            <label for="precioLista">Precio lista</label>
            <div>
                <input type="number" 
                            pInputText 
                            [(ngModel)]="precioLista" 
                            id="precioLista" 
                            (input)="cambiarPrecioLP(precioLista)"
                            class="w-8"
                            [disabled]="editarCalculo || optionSelectItemPT"
                            [ngClass]="{'ng-invalid ng-dirty' : envioForm && !fecha}">
                    <input type="number" 
                            pInputText 
                            id="prcLPrecio" 
                            [(ngModel)]="prcLPrecio"  
                            class="w-4"
                            [disabled]="editarCalculo || optionSelectItemPT"
                            (input)="cambiarPrcLP(prcLPrecio)"/>
                    <p-slider [(ngModel)]="prcLPrecio" 
                                [min]="-100" 
                                [max]="100"
                                [disabled]="editarCalculo || optionSelectItemPT"
                                (onSlideEnd)="cambioPrcLP($event)">
                    </p-slider>
            </div>
                    
        </div>
        <div class="field col">
            <label for="prcNeto">% Neto deseado</label>
            <div>
                <input type="number" 
                    pInputText 
                    id="prcNeto" 
                    [(ngModel)]="prcNeto"  
                    class="w-full"
                    [disabled]="editarCalculo || !optionSelectItemPT"
                    (input)="cambiarPrcNeto(prcNeto)"/>
            <p-slider [(ngModel)]="prcNeto" 
                        [min]="-100" 
                        [max]="100"
                        [disabled]="editarCalculo || !optionSelectItemPT"
                        (onSlideEnd)="cambioPrcNeto($event)">
            </p-slider>
            </div>
            
            
            
        </div>
    </div>
    <!------------------------------------------------------------->
    <!--Tabla calculadora semanas reposición-->
    <p-table #dt2 
            [value]="tablaCalculadora" 
            [rowHover]="true"
            styleClass="p-datatable-gridlines p-datatable-sm" 
            responsiveLayout="scroll">
            <ng-template pTemplate="caption">
                <div class="flex justify-content-between flex-column sm:flex-row">
                    <div>
                        <button pButton 
                                
                                pTooltip="Exportar a excel" tooltipPosition="bottom" placeholder="Bottom"   
                                class="p-button-outlined mb-2 mr-2 p-button-success p-button-sm" 
                                icon="pi pi-file-excel" 
                                (click)="exportExcel(tablaCalculadora)">
                                </button>

                                <button *ngIf="detalle_receta.length>0 && (item.ItemCode != 'ME2070005' || editarCalculo)" pButton 
                                pTooltip="ver detalle calculo" tooltipPosition="bottom" placeholder="Bottom"   
                                class="p-button-outlined mb-2 mr-2 p-button-warn p-button-sm" 
                                icon="pi pi-bars" 
                                (click)="detalleMP()">
                                </button>


                                
                                <button *ngIf="optionSelectItemPT || editarCalculo || (itemSeleted && !optionSelectItemPT && itemSeleted.ItemCode != 'ME2070005')" pButton  
                                    pTooltip="ver detalle calculo" tooltipPosition="bottom" placeholder="Bottom"   
                                    class="p-button-outlined mb-2 mr-2 p-button-warn p-button-sm" 
                                    icon="pi pi-bars" 
                                    (click)="detalleMPItems()">
                                </button>

                                <button *ngIf="itemSeleted && itemSeleted.ItemCode == 'ME2070005' && !editarCalculo"  pButton 
                                    pTooltip="Crear detalle" tooltipPosition="bottom" placeholder="Bottom"   
                                    class="p-button-outlined mb-2 mr-2 p-button-warning p-button-sm" 
                                    icon="pi pi-bars" 
                                    (click)="crearDetalleMP()">
                                </button>

                                <button pButton 
                                *ngIf="detalle_receta.length>0 && !editarCalculo && permisosUsuarioPagina[0].create_accion"
                                pTooltip="Guardar" tooltipPosition="bottom" placeholder="Bottom"   
                                class="p-button-outlined mb-2 mr-2 p-button-primary p-button-sm" 
                                icon="pi pi-save" 
                                (click)="guardarCalculo()">
                                </button>
                                
                    </div>

                    <div>
                        <button pButton 
                                
                                pTooltip="Parametros globales" tooltipPosition="bottom" placeholder="Bottom"   
                                class="p-button-outlined mb-2 mr-2 p-button-info p-button-sm" 
                                icon="pi pi-cog" 
                                (click)="parametrosGlobales()">
                                </button>
                    </div>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th class="surface-200 text-center" colspan="2">Producto</th>
                    <th class="surface-200 text-center" colspan="3">Lista precios SAP</th>
                    <th class="surface-200 text-center" rowspan="2">Precio promedio mercado</th>
                    <th class="surface-200 text-center" rowspan="2">Precio promedio venta</th>
                    <th class="bg-blue-200 text-center" colspan="2">Reposición semana 0</th>
                    <th class="bg-green-200 text-center" colspan="2">Reposición semana 1</th>
                    <th class="bg-yellow-200 text-center" colspan="2">Reposición semana 2</th>
                  
                </tr>
                <tr>
                    <th class="surface-200 text-center"><div class="text-center">Código item</div></th>
                    <th class="surface-200 text-left"><div class="text-left">Descripción</div></th>

                    <th class="surface-200 text-center"><div class="text-center">Gerente</div></th>
                    <th class="surface-200 text-center"><div class="text-center">Vendedor</div></th>
                    <th class="surface-200 text-center"><div class="text-center">Precio de lista</div></th>
                    
                    <th class="bg-blue-200 text-center"><div class="text-center">% Bruto</div></th>
                    <th class="bg-blue-200 text-center"><div class="text-center">% Neto</div></th>

                    <th class="bg-green-200 text-center"><div class="text-center">% Bruto</div></th>
                    <th class="bg-green-200 text-center"><div class="text-center">% Neto</div></th>

                    <th class="bg-yellow-200 text-center"><div class="text-center">% Bruto</div></th>
                    <th class="bg-yellow-200 text-center"><div class="text-center">% Neto</div></th>
                    
                   
                    
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-lineaCalculadora>
                <tr [class]="lineaCalculadora.linea==1?'bg-bluegray-50':''">
                    
                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.ItemCode }}</td>
                    <td style="min-width: 10rem; text-align: left;">{{ lineaCalculadora.ItemName }}</td>

                    <td *ngIf="lineaCalculadora.linea==1 && optionSelectItemPT && !editarCalculo" style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.lpGerente | number : '1.1-2'}}</td>
                    <td *ngIf="lineaCalculadora.linea==2 && optionSelectItemPT && !editarCalculo" pEditableColumn style="min-width: 2rem; text-align: center;">
                        
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText 
                                       type="number" 
                                       class="w-full"
                                       style="width: 12rem;"
                                       [(ngModel)]="lineaCalculadora.lpGerente"
                                       (keydown.enter)="PresionaEnterPrecioSugeridoCalculadora($event,lineaCalculadora.ItemCode,'LPGERENTE')"
                                       (blur)="cambioPrecioSugeridoCalculadora($event,lineaCalculadora.ItemCode,'LPGERENTE')">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{ lineaCalculadora.lpGerente | number : '1.1-2'}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <td *ngIf="editarCalculo || !optionSelectItemPT" style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.lpGerente | number : '1.1-2'}}</td>

                    <td *ngIf="lineaCalculadora.linea==1 && optionSelectItemPT && !editarCalculo" style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.lpVendedor | number : '1.1-2'}}</td>
                    <td *ngIf="lineaCalculadora.linea==2 && optionSelectItemPT && !editarCalculo" pEditableColumn style="min-width: 2rem; text-align: center;">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText 
                                       type="number" 
                                       class="w-full"
                                       style="width: 12rem;"
                                       [(ngModel)]="lineaCalculadora.lpVendedor"
                                       (keydown.enter)="PresionaEnterPrecioSugeridoCalculadora($event,lineaCalculadora.ItemCode,'LPVENDEDOR')"
                                       (blur)="cambioPrecioSugeridoCalculadora($event,lineaCalculadora.ItemCode,'LPVENDEDOR')">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{ lineaCalculadora.lpVendedor | number : '1.1-2'}}
                            </ng-template>
                        </p-cellEditor>
                        
                    </td>
                    <td *ngIf="editarCalculo || !optionSelectItemPT" style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.lpVendedor | number : '1.1-2'}}</td>


                    <td *ngIf="lineaCalculadora.linea==1 && optionSelectItemPT && !editarCalculo" style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.lPrecio | number : '1.1-2' }}</td>
                    <td *ngIf="lineaCalculadora.linea==2 && optionSelectItemPT && !editarCalculo" pEditableColumn style="min-width: 2rem; text-align: center;">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText 
                                       type="number" 
                                       class="w-full"
                                       style="width: 12rem;"
                                       [(ngModel)]="lineaCalculadora.lPrecio"
                                       (keydown.enter)="PresionaEnterPrecioSugeridoCalculadora($event,lineaCalculadora.ItemCode,'LP')"
                                       (blur)="cambioPrecioSugeridoCalculadora($event,lineaCalculadora.ItemCode,'LP')">
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{ lineaCalculadora.lPrecio | number : '1.1-2' }}
                            </ng-template>
                        </p-cellEditor>
                        
                    </td>
                    <td *ngIf="editarCalculo || !optionSelectItemPT" style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.lPrecio | number : '1.1-2' }}</td>

                    <td style="min-width: 6rem;  text-align: center; width: 6rem;">{{ lineaCalculadora.precioMercado | number : '1.1-2' }}</td>
                    <td style="min-width: 6rem;  text-align: center; width: 6rem;">{{ lineaCalculadora.precioVentaPT | number : '1.1-2' }}</td>

                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.brutoS0 | percent : '1.1-2' }}</td>
                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.totalS0 | percent : '1.1-2' }}</td>

                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.brutoS1 | percent : '1.1-2' }}</td>
                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.totalS1 | percent : '1.1-2' }}</td>

                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.brutoS2 | percent : '1.1-2' }}</td>
                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.totalS2 | percent : '1.1-2' }}</td>



                    
                    
                </tr>
           
            </ng-template>
           
          
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="16" class="text-center">No se econtraron materias primas asociadas al producto terminado seleccionado.</td>
                </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
                <tr>
                    <td colspan="16" class="text-center">Cargando materias primas asociadas al producto terminado. Por favor espere</td>
                </tr>
            </ng-template>
           
    </p-table>
    <!------------------------------------------------------------->

    <p-divider></p-divider>
    <!------ Tabla calculadora costos SAP ------------------------->
    <p-table #dt3 
            [value]="tablaCalculadoraCostos" 
            [rowHover]="true"
            styleClass="p-datatable-gridlines p-datatable-sm" 
            responsiveLayout="scroll">
            <ng-template pTemplate="caption">
                <div class="flex justify-content-between flex-column sm:flex-row">
                    <div>
                        <button pButton 
                                
                                pTooltip="Exportar a excel" tooltipPosition="bottom" placeholder="Bottom"   
                                class="p-button-outlined mb-2 mr-2 p-button-success p-button-sm" 
                                icon="pi pi-file-excel" 
                                (click)="exportExcel(tablaCalculadoraCostos)">
                                </button>

                                <!--<button *ngIf="detalle_receta.length>0" pButton 
                                pTooltip="ver detalle calculo" tooltipPosition="bottom" placeholder="Bottom"   
                                class="p-button-outlined mb-2 mr-2 p-button-warn p-button-sm" 
                                icon="pi pi-bars" 
                                (click)="detalleMP()">
                                </button>

                                <button pButton 
                                *ngIf="detalle_receta.length>0 && !editarCalculo"
                                pTooltip="Guardar" tooltipPosition="bottom" placeholder="Bottom"   
                                class="p-button-outlined mb-2 mr-2 p-button-primary p-button-sm" 
                                icon="pi pi-save" 
                                (click)="guardarCalculo()">
                                </button>-->
                                
                    </div>

                    <div>
                        <!--<button pButton 
                                
                                pTooltip="Parametros globales" tooltipPosition="bottom" placeholder="Bottom"   
                                class="p-button-outlined mb-2 mr-2 p-button-info p-button-sm" 
                                icon="pi pi-cog" 
                                (click)="parametrosGlobales()">
                                </button>-->
                    </div>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th class="surface-200 text-center" colspan="2">Producto</th>
                    <th class="surface-200 text-center" colspan="3">Lista precios SAP</th>
                    <th class="surface-200 text-center" rowspan="2">Precio promedio mercado</th>
                    <th class="surface-200 text-center" rowspan="2">Precio promedio venta</th>
                    <th class="bg-blue-200 text-center" colspan="2">Costo SAP</th>
                   
                  
                </tr>
                <tr>
                    <th class="surface-200 text-center"><div class="text-center">Código item</div></th>
                    <th class="surface-200 text-left"><div class="text-left">Descripción</div></th>

                    <th class="surface-200 text-center"><div class="text-center">Gerente</div></th>
                    <th class="surface-200 text-center"><div class="text-center">Vendedor</div></th>
                    <th class="surface-200 text-center"><div class="text-center">Precio de lista</div></th>
                    
                    <th class="bg-blue-200 text-center"><div class="text-center">% Bruto</div></th>
                    <th class="bg-blue-200 text-center"><div class="text-center">% Neto</div></th>

                   
                    
                   
                    
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-lineaCalculadora>
                <tr [class]="lineaCalculadora.linea==1?'bg-bluegray-50':''">
                    
                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.ItemCode }}</td>
                    <td style="min-width: 10rem; text-align: left;">{{ lineaCalculadora.ItemName }}</td>

                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.lpGerente | number : '1.1-2'}}</td>
                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.lpVendedor | number : '1.1-2'}}</td>
                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.lPrecio | number : '1.1-2' }}</td>

                    <td style="min-width: 6rem;  text-align: center; width: 6rem;">{{ lineaCalculadora.precioMercado | number: '1.1-2'  }}</td>
                    <td style="min-width: 6rem;  text-align: center; width: 6rem;">{{ lineaCalculadora.precioVentaPT | number: '1.1-2'  }}</td>

                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.brutoS0 | percent :'1.1-2' }}</td>
                    <td style="min-width: 2rem; text-align: center;">{{ lineaCalculadora.totalS0 | percent :'1.1-2' }}</td>

                



                    
                    
                </tr>
           
            </ng-template>
           
          
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="12" class="text-center">No se econtraron materias primas asociadas al producto terminado seleccionado.</td>
                </tr>
            </ng-template>
            <ng-template pTemplate="loadingbody">
                <tr>
                    <td colspan="12" class="text-center">Cargando materias primas asociadas al producto terminado. Por favor espere</td>
                </tr>
            </ng-template>
           
    </p-table>
    <!-------------------------------------------------------------->

    
        
    
</div>


<!-- Fin Calculadora de precios -->


<!---Dilalog FORM detalle calculo-->
    <p-dialog [header]="'Detalle calculo MP '+!item?'':item.ItemName" 
          [(visible)]="formDetalleCalculo" 
          [modal]="true"
          [breakpoints]="{'960px': '75vw', '640px': '100vw'}" 
          [style]="{width: '50vw'}" 
          [maximizable]="true"
          [draggable]="false" 
          [resizable]="false">

    <ng-template pTemplate="content">
        
        <!-- Detalle de materia prima-->


        <div class="card p-10">
            
            <p-table #dt1 
                    [value]="detalle_receta" 
                    [rowHover]="true"
                    styleClass="p-datatable-gridlines p-datatable-sm" 
                    responsiveLayout="scroll">
                <ng-template pTemplate="caption">
                    <div class="flex justify-content-between flex-column sm:flex-row">
                        <div>
                            <button pButton 
                                    
                                    pTooltip="Exportar a excel" tooltipPosition="bottom" placeholder="Bottom"   
                                    class="p-button-outlined mb-2 mr-2 p-button-success p-button-sm" 
                                    icon="pi pi-file-excel" 
                                    (click)="exportExcel(detalle_receta)">
                                    </button>

                               
                                    
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th class="surface-200 text-center" colspan="6">Info MP</th>
                        <th class="bg-blue-200 text-center" colspan="4">Semana 0</th>
                        <th class="bg-green-200 text-center" colspan="4">Semana 1</th>
                        <th class="bg-yellow-200 text-center" colspan="4">semana 2</th>
                    </tr>
                    <tr>
                        <th class="surface-200 text-center"><div class="text-center">Código item</div></th>
                        <th class="surface-200 text-left"><div class="text-left">Descripción</div></th>
                        <th class="surface-200 text-center"><div class="text-center">Empaque</div></th>
                        <th class="surface-200 text-center"><div class="text-center">Costo</div></th>
                        <th class="surface-200 text-center"><div class="text-center">Cantidad</div></th>
                        <th class="surface-200 text-center"><div class="text-center">Costo SAP</div></th>

                        <th class="bg-blue-200 text-center"><div class="text-center">Año</div></th>
                        <th class="bg-blue-200 text-center"><div class="text-center">Semana</div></th>
                        <th class="bg-blue-200 text-right"><div class="text-right">Costo MP</div></th>
                        <th class="bg-blue-200 text-right"><div class="text-right">Costo Empaque</div></th>
                 
                       
                        <th class="bg-green-200 text-center"><div class="text-center">Año</div></th>
                        <th class="bg-green-200 text-center"><div class="text-center">Semana</div></th>
                        <th class="bg-green-200 text-right"><div class="text-right">Costo MP</div></th>
                        <th class="bg-green-200 text-right"><div class="text-right">Costo Empaque</div></th>

                        <th class="bg-yellow-200 text-center"><div class="text-center">Año</div></th>
                        <th class="bg-yellow-200 text-center"><div class="text-center">Semana</div></th>
                        <th class="bg-yellow-200 text-right"><div class="text-right">Costo MP</div></th>
                        <th class="bg-yellow-200 text-right" style="text-align: right;"><div class="text-right">Costo Empaque</div></th>
                        
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-product>
                    <tr>
                        
                        <td style="min-width: 2rem; text-align: center;">{{ product.itemMP.Code }}</td>
                        <td style="min-width: 10rem; text-align: left;">{{ product.itemMP.ItemName }}</td>
                        <td style="min-width: 2rem; text-align: center;">{{ product.itemMP.EMPAQUE }}</td>
                        
                        <td style="min-width: 4rem; text-align: center;">{{ (product.itemMP.precioItem) | number  : '1.1-2'}}</td>
                        <td style="min-width: 4rem; text-align: center;">{{ product.itemMP.Quantity | number  : '1.1-2'}}</td>
                       
                        <td style="min-width: 4rem; text-align: right;">{{ product.itemMP.costoSAP | number : '1.1-2'}}</td>



                        <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana0.anio  }}</td>
                        <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana0.semana | number  }}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana0.costoMP | number : '1.1-2' }}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana0.empaqueMP | number: '1.1-2' }}</td>
                        <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana1.anio  }}</td>
                        <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana1.semana | number  }}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana1.costoMP | number : '1.1-2' }}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana1.empaqueMP | number : '1.1-2'}}</td>
                        <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana2.anio  }}</td>
                        <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana2.semana | number  }}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana2.costoMP | number : '1.1-2' }}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana2.empaqueMP | number : '1.1-2'}}</td>
                     
                        
                    </tr>
                </ng-template>
                <ng-template pTemplate="footer">
                    <tr>
                        <td style="min-width: 2rem; text-align: center;" colspan="4">Totales</td>
                        <td style="min-width: 2rem; text-align: center;">{{ totalCantidadArticulos | number : '1.1-2'}}</td>
                        <td style="min-width: 2rem; text-align: center;">{{ totalCostoPTSAP | number : '1.1-2'}}</td>
                        <td class="bg-blue-200" colspan="2">{{(totalMPsemana0+totalEmpaque | number: '1.1-2')}}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalMPsemana0 | number : '1.1-2'}}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalEmpaque | number : '1.1-2'}}</td>
                        <td class="bg-green-200" colspan="2">{{(totalMPsemana1+totalEmpaque | number: '1.1-2')}}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalMPsemana1 | number: '1.1-2' }}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalEmpaque | number : '1.1-2'}}</td>
                        <td class="bg-yellow-200" colspan="2">{{(totalMPsemana2+totalEmpaque | number: '1.1-2')}}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalMPsemana2 | number: '1.1-2' }}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalEmpaque | number: '1.1-2' }}</td>
          
                    </tr>
                    <tr>
                      
                      <td style="min-width: 2rem; text-align: center;" colspan="4" >Merma</td>
                      <td style="min-width: 2rem; text-align: center;"  >{{merma | number: '1.1-2'}}</td>
                      <td style="min-width: 2rem; text-align: center;"  >{{merma*totalCostoPTSAP | number: '1.1-2'}}</td>
                      <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ merma*(totalMPsemana0+totalEmpaque) | number: '1.1-2' }}</td>
                      <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="6"></td>
                      <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ merma*(totalMPsemana1+totalEmpaque) | number: '1.1-2' }}</td>
                      <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="6"></td>
                      <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ merma*(totalMPsemana2+totalEmpaque) | number: '1.1-2' }}</td>
                      <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="6"></td>
                  </tr>
          
                  <tr>
                      
                      <td style="min-width: 2rem; text-align: center;" colspan="4">Costo</td>
                      <td style="min-width: 2rem; text-align: center;"  >{{merma+totalCantidadArticulos | number: '1.1-2'}}</td>
                      <td style="min-width: 2rem; text-align: center;"  >{{(merma*totalCostoPTSAP)+totalCostoPTSAP | number: '1.1-2'}}</td>
                      <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ (merma*(totalMPsemana0+totalEmpaque))+(totalMPsemana0+totalEmpaque) | number: '1.1-2' }}</td>
                      <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ (merma*(totalMPsemana1+totalEmpaque))+(totalMPsemana1+totalEmpaque) | number: '1.1-2' }}</td>
                      <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ (merma*(totalMPsemana2+totalEmpaque))+(totalMPsemana2+totalEmpaque) | number: '1.1-2' }}</td>
                  </tr>
                    <tr>
                        
                        <td style="min-width: 2rem; text-align: center;" colspan="5" >Recurso</td>
                        <td style="min-width: 2rem; text-align: center;">{{recursoPT | number: '1.1-2' }}</td>
                        <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ recursoPT | number: '1.1-2' }}</td>
                        <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ recursoPT | number: '1.1-2' }}</td>
                        <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ recursoPT | number: '1.1-2' }}</td>
                    </tr>
                    <tr>
                        <td style="min-width: 2rem; text-align: center;" colspan="5">Costo venta</td>
                        <td style="min-width: 2rem; text-align: center;">{{ costoVentaPTSAP | number: '1.1-2' }}</td>
                        <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoVentaPTsemana0 | number: '1.1-2' }}</td>
                        <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoVentaPTsemana1 | number: '1.1-2' }}</td>
                        <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoVentaPTsemana2 | number: '1.1-2' }}</td>
                    </tr>
          
                    <tr>
                        <td style="min-width: 2rem; text-align: center;" colspan="5">Administración</td>
                        <td style="min-width: 2rem; text-align: center;">{{ administracion | number: '1.1-2' }}</td>
                        <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ administracion | number: '1.1-2' }}</td>
                        <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ administracion | number: '1.1-2' }}</td>
                        <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ administracion | number: '1.1-2' }}</td>
                    </tr>
          
                    <tr>
                        <td style="min-width: 2rem; text-align: center;" colspan="5">Costo total</td>
                        <td style="min-width: 2rem; text-align: center;">{{ costoTotalPTSAP | number: '1.1-2' }}</td>
                        <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoTotalPTsemana0 | number: '1.1-2' }}</td>
                        <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoTotalPTsemana1 | number: '1.1-2' }}</td>
                        <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoTotalPTsemana2 | number: '1.1-2' }}</td>
                    </tr>          
                    <!--<tr>
                        <td style="min-width: 2rem; text-align: center;" colspan="4" rowspan="5">Totales</td>
                        <td style="min-width: 2rem; text-align: center;">Costo</td>
                        <td style="min-width: 2rem; text-align: center;">{{ totalCostoPTSAP | number : '1.1-2'}}</td>
                        <td class="bg-blue-200" colspan="2">{{(totalMPsemana0+totalEmpaque | number: '1.1-2')}}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalMPsemana0 | number : '1.1-2'}}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalEmpaque | number : '1.1-2'}}</td>

                        <td class="bg-green-200" colspan="2">{{(totalMPsemana1+totalEmpaque | number: '1.1-2')}}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalMPsemana1 | number: '1.1-2' }}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalEmpaque | number : '1.1-2'}}</td>

                        <td class="bg-yellow-200" colspan="2">{{(totalMPsemana2+totalEmpaque | number: '1.1-2')}}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalMPsemana2 | number: '1.1-2' }}</td>
                        <td style="min-width: 2rem; text-align: right;">{{ totalEmpaque | number: '1.1-2' }}</td>

                    </tr>
                    <tr>
                        
                        <td style="min-width: 2rem; text-align: center;">Recurso</td>
                        <td style="min-width: 2rem; text-align: center;">{{recursoPTSAP | number: '1.1-2' }}</td>
                        <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ recursoPT | number: '1.1-2' }}</td>
                        <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="4"></td>
                        <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ recursoPT | number: '1.1-2' }}</td>
                        <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="4"></td>
                        <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ recursoPT | number: '1.1-2' }}</td>
                        <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="4"></td>
                    </tr>
                    <tr>
                        
                        <td style="min-width: 2rem; text-align: center;">Costo venta</td>
                        <td style="min-width: 2rem; text-align: center;">{{ costoVentaPTSAP | number: '1.1-2' }}</td>
                        <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoVentaPTsemana0 | number: '1.1-2' }}</td>
                        
                        <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoVentaPTsemana1 | number: '1.1-2' }}</td>
                        
                        <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoVentaPTsemana2 | number: '1.1-2' }}</td>
                        
                    </tr>

                    <tr>
                        
                        <td style="min-width: 2rem; text-align: center;">Administración</td>
                        <td style="min-width: 2rem; text-align: center;">{{ administracion | number: '1.1-2' }}</td>
                        <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ administracion | number: '1.1-2' }}</td>
                        
                        <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ administracion | number: '1.1-2' }}</td>
                        
                        <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ administracion | number: '1.1-2' }}</td>
                        
                    </tr>

                    <tr>
                        
                        <td style="min-width: 2rem; text-align: center;">Costo total</td>
                        <td style="min-width: 2rem; text-align: center;">{{ costoTotalPTSAP | number: '1.1-2' }}</td>
                        <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoTotalPTsemana0 | number: '1.1-2' }}</td>
                        
                        <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoTotalPTsemana1 | number: '1.1-2' }}</td>
                        
                        <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoTotalPTsemana2 | number: '1.1-2' }}</td>
                        
                    </tr>-->
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="16" class="text-center">No se econtraron materias primas asociadas al producto terminado seleccionado.</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="loadingbody">
                    <tr>
                        <td colspan="16" class="text-center">Cargando materias primas asociadas al producto terminado. Por favor espere</td>
                    </tr>
                </ng-template>
            </p-table>
            
        </div>

        <!-- Fin detalle de materia prima-->


    </ng-template>
    <ng-template pTemplate="footer">
        <p-button   icon="pi pi-check" 
                    (onClick)="formDetalleCalculo=false"                     
                    
                    label="Cerrar"
                    styleClass="p-button-text">
        </p-button>
    </ng-template>
    </p-dialog>
<!---Fin dialog Form detalle -->


<!---Dilalog FORM detalle calculo-->
<p-dialog [header]="'Detalle calculos MP Items '" 
[(visible)]="formDetalleCalculosItems" 
[modal]="true"
[breakpoints]="{'960px': '75vw', '640px': '100vw'}" 
[style]="{width: '50vw'}" 
[maximizable]="true"
[draggable]="false" 
[resizable]="false">

<ng-template pTemplate="content">

<!-- Detalle de materia prima-->


<div *ngFor="let itemArrayPT of arrayCalculadoraMultiple" class="card p-10">
  
  <p-table #dt7 
          [value]="itemArrayPT.tablaCostosItemPT.detalle_receta" 
          [rowHover]="true"
          styleClass="p-datatable-gridlines p-datatable-sm" 
          responsiveLayout="scroll">
      <ng-template pTemplate="caption">
          <div class="flex justify-content-between flex-column sm:flex-row">
              <div>
                  <button pButton 
                          
                          pTooltip="Exportar a excel" tooltipPosition="bottom" placeholder="Bottom"   
                          class="p-button-outlined mb-2 mr-2 p-button-success p-button-sm" 
                          icon="pi pi-file-excel" 
                          (click)="exportExcel(itemArrayPT.tablaCostosItemPT.detalle_receta)">
                  </button>

                  

                     
                          
              </div>

              <div>
                <span>
                    {{ itemArrayPT.label }}
                </span>
              </div>

          </div>
      </ng-template>
      <ng-template pTemplate="header">
          <tr>
              <th class="surface-200 text-center" colspan="6">Info MP</th>
              <th class="bg-blue-200 text-center" colspan="4">Semana 0</th>
              <th class="bg-green-200 text-center" colspan="4">Semana 1</th>
              <th class="bg-yellow-200 text-center" colspan="4">semana 2</th>
          </tr>
          <tr>
              <th class="surface-200 text-center"><div class="text-center">Código item</div></th>
              <th class="surface-200 text-left"><div class="text-left">Descripción</div></th>
              <th class="surface-200 text-center"><div class="text-center">Empaque</div></th>
              <th class="surface-200 text-center"><div class="text-center">Costo</div></th>
              <th class="surface-200 text-center"><div class="text-center">Cantidad</div></th>
              <th class="surface-200 text-center"><div class="text-center">Costo SAP</div></th>

              <th class="bg-blue-200 text-center"><div class="text-center">Año</div></th>
              <th class="bg-blue-200 text-center"><div class="text-center">Semana</div></th>
              <th class="bg-blue-200 text-right"><div class="text-right">Costo MP</div></th>
              <th class="bg-blue-200 text-right"><div class="text-right">Costo Empaque</div></th>
       
             
              <th class="bg-green-200 text-center"><div class="text-center">Año</div></th>
              <th class="bg-green-200 text-center"><div class="text-center">Semana</div></th>
              <th class="bg-green-200 text-right"><div class="text-right">Costo MP</div></th>
              <th class="bg-green-200 text-right"><div class="text-right">Costo Empaque</div></th>

              <th class="bg-yellow-200 text-center"><div class="text-center">Año</div></th>
              <th class="bg-yellow-200 text-center"><div class="text-center">Semana</div></th>
              <th class="bg-yellow-200 text-right"><div class="text-right">Costo MP</div></th>
              <th class="bg-yellow-200 text-right" style="text-align: right;"><div class="text-right">Costo Empaque</div></th>
              
          </tr>
      </ng-template>
      <ng-template pTemplate="body" let-product>
          <tr>
              
              <td style="min-width: 2rem; text-align: center;">{{ product.itemMP.Code }}</td>
              <td style="min-width: 10rem; text-align: left;">{{ product.itemMP.ItemName }}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.itemMP.EMPAQUE }}</td>
              
              <td style="min-width: 4rem; text-align: center;">{{ (product.itemMP.precioItem) | number  : '1.1-2'}}</td>
              <td style="min-width: 4rem; text-align: center;">{{ product.itemMP.Quantity | number  : '1.1-2'}}</td>
             
              <td style="min-width: 4rem; text-align: right;">{{ product.itemMP.costoSAP | number : '1.1-2'}}</td>



              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana0.anio  }}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana0.semana | number  }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana0.costoMP | number : '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana0.empaqueMP | number: '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana1.anio  }}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana1.semana | number  }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana1.costoMP | number : '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana1.empaqueMP | number : '1.1-2'}}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana2.anio  }}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana2.semana | number  }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana2.costoMP | number : '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana2.empaqueMP | number : '1.1-2'}}</td>
           
              
          </tr>
      </ng-template>
      <ng-template pTemplate="footer">
          <tr>
              <td style="min-width: 2rem; text-align: center;" colspan="4">Totales</td>
              <td style="min-width: 2rem; text-align: center;">{{ itemArrayPT.tablaCostosItemPT.totalArticulos | number : '1.1-2'}}</td>
              <td style="min-width: 2rem; text-align: center;">{{ itemArrayPT.tablaCostosItemPT.totalCostoPTSAP | number : '1.1-2'}}</td>
              <td class="bg-blue-200" colspan="2">{{(itemArrayPT.tablaCostosItemPT.totalMPsemana0+itemArrayPT.tablaCostosItemPT.totalEmpaque | number: '1.1-2')}}</td>
              <td style="min-width: 2rem; text-align: right;">{{ itemArrayPT.tablaCostosItemPT.totalMPsemana0 | number : '1.1-2'}}</td>
              <td style="min-width: 2rem; text-align: right;">{{ itemArrayPT.tablaCostosItemPT.totalEmpaque | number : '1.1-2'}}</td>
              <td class="bg-green-200" colspan="2">{{(itemArrayPT.tablaCostosItemPT.totalMPsemana1+itemArrayPT.tablaCostosItemPT.totalEmpaque | number: '1.1-2')}}</td>
              <td style="min-width: 2rem; text-align: right;">{{ itemArrayPT.tablaCostosItemPT.totalMPsemana1 | number: '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ itemArrayPT.tablaCostosItemPT.totalEmpaque | number : '1.1-2'}}</td>
              <td class="bg-yellow-200" colspan="2">{{(itemArrayPT.tablaCostosItemPT.totalMPsemana2+itemArrayPT.tablaCostosItemPT.totalEmpaque | number: '1.1-2')}}</td>
              <td style="min-width: 2rem; text-align: right;">{{ itemArrayPT.tablaCostosItemPT.totalMPsemana2 | number: '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ itemArrayPT.tablaCostosItemPT.totalEmpaque | number: '1.1-2' }}</td>

          </tr>
          <tr>
            
            <td style="min-width: 2rem; text-align: center;" colspan="4" >Merma</td>
            <td style="min-width: 2rem; text-align: center;"  >{{itemArrayPT.tablaCostosItemPT.merma | number: '1.1-2'}}</td>
            <td style="min-width: 2rem; text-align: center;"  >{{itemArrayPT.tablaCostosItemPT.merma*itemArrayPT.tablaCostosItemPT.totalCostoPTSAP | number: '1.1-2'}}</td>
            <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.merma*(itemArrayPT.tablaCostosItemPT.totalMPsemana0+itemArrayPT.tablaCostosItemPT.totalEmpaque) | number: '1.1-2' }}</td>
            <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="6"></td>
            <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.merma*(itemArrayPT.tablaCostosItemPT.totalMPsemana1+itemArrayPT.tablaCostosItemPT.totalEmpaque) | number: '1.1-2' }}</td>
            <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="6"></td>
            <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.merma*(itemArrayPT.tablaCostosItemPT.totalMPsemana2+itemArrayPT.tablaCostosItemPT.totalEmpaque) | number: '1.1-2' }}</td>
            <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="6"></td>
        </tr>

        <tr>
            
            <td style="min-width: 2rem; text-align: center;" colspan="4">Costo</td>
            <td style="min-width: 2rem; text-align: center;"  >{{itemArrayPT.tablaCostosItemPT.merma+itemArrayPT.tablaCostosItemPT.totalArticulos | number: '1.1-2'}}</td>
            <td style="min-width: 2rem; text-align: center;"  >{{(itemArrayPT.tablaCostosItemPT.merma*itemArrayPT.tablaCostosItemPT.totalCostoPTSAP)+itemArrayPT.tablaCostosItemPT.totalCostoPTSAP | number: '1.1-2'}}</td>
            <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ (itemArrayPT.tablaCostosItemPT.merma*(itemArrayPT.tablaCostosItemPT.totalMPsemana0+itemArrayPT.tablaCostosItemPT.totalEmpaque))+(itemArrayPT.tablaCostosItemPT.totalMPsemana0+itemArrayPT.tablaCostosItemPT.totalEmpaque) | number: '1.1-2' }}</td>
            <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ (itemArrayPT.tablaCostosItemPT.merma*(itemArrayPT.tablaCostosItemPT.totalMPsemana1+itemArrayPT.tablaCostosItemPT.totalEmpaque))+(itemArrayPT.tablaCostosItemPT.totalMPsemana1+itemArrayPT.tablaCostosItemPT.totalEmpaque) | number: '1.1-2' }}</td>
            <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ (itemArrayPT.tablaCostosItemPT.merma*(itemArrayPT.tablaCostosItemPT.totalMPsemana2+itemArrayPT.tablaCostosItemPT.totalEmpaque))+(itemArrayPT.tablaCostosItemPT.totalMPsemana2+itemArrayPT.tablaCostosItemPT.totalEmpaque) | number: '1.1-2' }}</td>
        </tr>
          <tr>
              
              <td style="min-width: 2rem; text-align: center;" colspan="5" >Recurso</td>
              <td style="min-width: 2rem; text-align: center;">{{itemArrayPT.tablaCostosItemPT.costoRecursoItemPT | number: '1.1-2' }}</td>
              <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoRecursoItemPT | number: '1.1-2' }}</td>
              <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoRecursoItemPT | number: '1.1-2' }}</td>
              <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoRecursoItemPT | number: '1.1-2' }}</td>
          </tr>
          <tr>
              <td style="min-width: 2rem; text-align: center;" colspan="5">Costo venta</td>
              <td style="min-width: 2rem; text-align: center;">{{ itemArrayPT.tablaCostosItemPT.costoVentaPTSAP | number: '1.1-2' }}</td>
              <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoVentaPTsemana0 | number: '1.1-2' }}</td>
              <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoVentaPTsemana1 | number: '1.1-2' }}</td>
              <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoVentaPTsemana2 | number: '1.1-2' }}</td>
          </tr>

          <tr>
              <td style="min-width: 2rem; text-align: center;" colspan="5">Administración</td>
              <td style="min-width: 2rem; text-align: center;">{{ itemArrayPT.tablaCostosItemPT.costoAdministracionEstandar | number: '1.1-2' }}</td>
              <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoAdministracionEstandar | number: '1.1-2' }}</td>
              <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoAdministracionEstandar | number: '1.1-2' }}</td>
              <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoAdministracionEstandar | number: '1.1-2' }}</td>
          </tr>

          <tr>
              <td style="min-width: 2rem; text-align: center;" colspan="5">Costo total</td>
              <td style="min-width: 2rem; text-align: center;">{{ itemArrayPT.tablaCostosItemPT.costoTotalPTSAP | number: '1.1-2' }}</td>
              <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoTotalPTsemana0 | number: '1.1-2' }}</td>
              <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoTotalPTsemana1 | number: '1.1-2' }}</td>
              <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ itemArrayPT.tablaCostosItemPT.costoTotalPTsemana2 | number: '1.1-2' }}</td>
          </tr>          
         
      </ng-template>
      <ng-template pTemplate="emptymessage">
          <tr>
              <td colspan="16" class="text-center">No se econtraron materias primas asociadas al producto terminado seleccionado.</td>
          </tr>
      </ng-template>
      <ng-template pTemplate="loadingbody">
          <tr>
              <td colspan="16" class="text-center">Cargando materias primas asociadas al producto terminado. Por favor espere</td>
          </tr>
      </ng-template>
  </p-table>
  
</div>

<!-- Fin detalle de materia prima-->


</ng-template>
<ng-template pTemplate="footer">
<p-button   icon="pi pi-check" 
          (onClick)="formDetalleCalculosItems=false"                     
          
          label="Cerrar"
          styleClass="p-button-text">
</p-button>
</ng-template>
</p-dialog>
<!---Fin dialog Form detalle -->


<!---Dilalog FORM Create detalle calculo-->
<p-dialog [header]="'Detalle calculo MP '+!item?'':item.ItemName" 
            [(visible)]="formCrreateDetalleCalculo" 
            [modal]="true"
            [breakpoints]="{'960px': '75vw', '640px': '100vw'}" 
            [style]="{width: '50vw'}" 
            [maximizable]="true"
            [draggable]="false" 
            [resizable]="false">

<ng-template pTemplate="content">

<!-- Detalle de materia prima-->


<div class="card p-10">
  
  <p-table #dt6
          [value]="detalle_receta" 
          [rowHover]="true"
          styleClass="p-datatable-gridlines p-datatable-sm" 
          selectionMode="single" 
		  [(selection)]="selectedDetalleReceta"
          responsiveLayout="scroll">
      <ng-template pTemplate="caption">
          <div class="flex justify-content-between flex-column sm:flex-row">
              <div>
                  <button pButton 
                          
                          pTooltip="Exportar a excel" tooltipPosition="bottom" placeholder="Bottom"   
                          class="p-button-outlined mb-2 mr-2 p-button-success p-button-sm" 
                          icon="pi pi-file-excel" 
                          (click)="exportExcel(detalle_receta)">
                          </button>
                    
                          <button pButton 
                          
                          pTooltip="Adicionar linea" tooltipPosition="bottom" placeholder="Bottom"   
                          class="p-button-outlined mb-2 mr-2 p-button-success p-button-sm" 
                          icon="pi pi-plus" 
                          (click)="adicionarLinea()">
                          </button>

                          <button pButton 
                                
                                pTooltip="Borrar linea" tooltipPosition="bottom" placeholder="Bottom"   
                                class="p-button-outlined mb-2 mr-2 p-button-danger p-button-sm" 

                                icon="pi pi-trash" 
                                (click)="borrarLinea()" 
                                [disabled]="!selectedDetalleReceta || selectedDetalleReceta.length!=1">
						 </button>

                     
                          
              </div>
              <div class="flex justify-content-between align-content-center">
                
                <span class="pt-3 pr-3">Merma:</span>
                <input pInputText type="number" 
                       [(ngModel)]="merma"
                       placeholder="Ingresar merma"
                       class="w-full p-inputtext-sm"
                       (keydown.enter)="calcularTotalesDetalleCalculo(0)"
                       (blur)="calcularTotalesDetalleCalculo(0)"/>
              </div>
                
            
          </div>
      </ng-template>
      <ng-template pTemplate="header">
          <tr>
              <th class="surface-200 text-center" colspan="8">Info MP</th>
              <th class="bg-blue-200 text-center" colspan="4">Semana 0</th>
              <th class="bg-green-200 text-center" colspan="4">Semana 1</th>
              <th class="bg-yellow-200 text-center" colspan="4">semana 2</th>
          </tr>
          <tr>
            
              <th class="surface-200 text-center" style="width: 3rem"><!--<p-tableHeaderCheckbox></p-tableHeaderCheckbox>--></th>
              <th class="surface-200 text-center"><div class="text-center">Tipo item</div></th>
              <th class="surface-200 text-center"><div class="text-center">Código item</div></th>
              <th class="surface-200 text-left"><div class="text-left">Descripción</div></th>
              <th class="surface-200 text-center"><div class="text-center">Empaque</div></th>
              <th class="surface-200 text-center"><div class="text-center">Costo</div></th>
              <th class="surface-200 text-center"><div class="text-center">Cantidad</div></th>
              <th class="surface-200 text-center"><div class="text-center">Costo SAP</div></th>

              <th class="bg-blue-200 text-center"><div class="text-center">Año</div></th>
              <th class="bg-blue-200 text-center"><div class="text-center">Semana</div></th>
              <th class="bg-blue-200 text-right"><div class="text-right">Costo MP</div></th>
              <th class="bg-blue-200 text-right"><div class="text-right">Costo Empaque</div></th>
       
             
              <th class="bg-green-200 text-center"><div class="text-center">Año</div></th>
              <th class="bg-green-200 text-center"><div class="text-center">Semana</div></th>
              <th class="bg-green-200 text-right"><div class="text-right">Costo MP</div></th>
              <th class="bg-green-200 text-right"><div class="text-right">Costo Empaque</div></th>

              <th class="bg-yellow-200 text-center"><div class="text-center">Año</div></th>
              <th class="bg-yellow-200 text-center"><div class="text-center">Semana</div></th>
              <th class="bg-yellow-200 text-right"><div class="text-right">Costo MP</div></th>
              <th class="bg-yellow-200 text-right" style="text-align: right;"><div class="text-right">Costo Empaque</div></th>
              
          </tr>
      </ng-template>
      <ng-template pTemplate="body" let-product>
          <tr>
            <td><p-tableCheckbox [value]="product"
                                 [disabled]="product.itemMP.index<=3">
            </p-tableCheckbox></td>
            <td style="min-width: 2rem; text-align: center;">{{ product.itemMP.tipo | titlecase  }}</td>
              <td pEditableColumn style="min-width: 2rem; text-align: center;">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <p-dropdown *ngIf="product.itemMP.tipo=='empaque'" 
                                    [options]="empaques" 
                                    [(ngModel)]="selectedEmpaque" 
                                    optionLabel="label" 
                                    [filter]="true" 
                                    filterBy="label" 
                                    [showClear]="true"
                                    (onChange)="seleccionarItemDetalle(product.itemMP.index,selectedEmpaque)" 
                                    placeholder="Seleccione un empaque">
                            <ng-template pTemplate="selectedItem">
                                
                                    <div>{{selectedEmpaque.ItemCode}}</div>
                                
                            </ng-template>
                            <ng-template let-empaque pTemplate="item">
                                <div class="country-item">
                                    
                                    <div>{{empaque.label}}</div>
                                </div>
                            </ng-template>
                        </p-dropdown>

                        <p-dropdown *ngIf="product.itemMP.tipo=='protector'" 
                                    [options]="protectores" 
                                    [(ngModel)]="selectedProtector" 
                                    optionLabel="label" 
                                    [filter]="true" 
                                    filterBy="label" 
                                    [showClear]="true"
                                    (onChange)="seleccionarItemDetalle(product.itemMP.index,selectedProtector)" 
                                    placeholder="Seleccione un protector">
                            <ng-template pTemplate="selectedItem">
                                
                                    <div>{{selectedProtector.ItemCode}}</div>
                                
                            </ng-template>
                            <ng-template let-protector pTemplate="item">
                                <div class="country-item">
                                    
                                    <div>{{protector.label}}</div>
                                </div>
                            </ng-template>
                        </p-dropdown>


                        <p-dropdown *ngIf="product.itemMP.tipo=='articulo'" 
                                    [options]="itemsMP" 
                                    [(ngModel)]="selecteditemMP" 
                                    optionLabel="label" 
                                    [filter]="true" 
                                    filterBy="label" 
                                    [showClear]="true"
                                    (onChange)="seleccionarItemDetalle(product.itemMP.index,selecteditemMP)" 
                                    placeholder="Seleccione un articulo">
                            <ng-template pTemplate="selectedItem">
                                
                                    <div>{{selecteditemMP.ItemCode}}</div>
                                
                            </ng-template>
                            <ng-template let-itemMP pTemplate="item">
                                <div class="country-item">
                                    
                                    <div>{{itemMP.label}}</div>
                                </div>
                            </ng-template>
                        </p-dropdown> 

                    </ng-template>
                    <ng-template pTemplate="output">
                        {{ product.itemMP.Code }}
                    </ng-template>
                </p-cellEditor>
              </td>
              <td style="min-width: 10rem; text-align: left;">{{ product.itemMP.ItemName }}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.itemMP.EMPAQUE }}</td>
              
              <td style="min-width: 4rem; text-align: right;">{{ product.itemMP.costo | number : '1.1-2'}}</td>
              
              <td *ngIf="!editarCalculo" pEditableColumn style="width: 12rem; text-align: right;">
                  <p-cellEditor>
                      <ng-template pTemplate="input">
                          <input pInputText 
                                 type="number" 
                                 class="w-full"
                                 style="width: 12rem;"
                                 [(ngModel)]="product.itemMP.Quantity"
                                 (keydown.enter)="PresionaEnterCantidadMP($event,product.itemMP.index,product.itemMP.tipo)"
                                 (blur)="cambioCantidadMP($event,product.itemMP.index,product.itemMP.tipo)">
                      </ng-template>
                      <ng-template pTemplate="output">
                          {{ product.itemMP.Quantity | number  }}
                      </ng-template>
                  </p-cellEditor>
              </td>

              <td *ngIf="editarCalculo" style="width: 12rem; text-align: right;">{{ product.itemMP.Quantity | number  }}</td>

              
              <td style="min-width: 4rem; text-align: right;">{{ product.itemMP.costoSAP | number : '1.1-2'}}</td>



              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana0.anio  }}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana0.semana | number  }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana0.costoMP | number : '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana0.empaqueMP | number: '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana1.anio  }}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana1.semana | number  }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana1.costoMP | number : '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana1.empaqueMP | number : '1.1-2'}}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana2.anio  }}</td>
              <td style="min-width: 2rem; text-align: center;">{{ product.costosItemMP.semana2.semana | number  }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana2.costoMP | number : '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ product.costosItemMP.semana2.empaqueMP | number : '1.1-2'}}</td>
           
              
          </tr>
      </ng-template>
      <ng-template pTemplate="footer">
          <tr>
              <td style="min-width: 2rem; text-align: center;" colspan="6">Totales</td>
              <td style="min-width: 2rem; text-align: center;">{{ totalCantidadArticulos | number : '1.1-2'}}</td>
              <td style="min-width: 2rem; text-align: center;">{{ totalCostoPTSAP | number : '1.1-2'}}</td>
              <td class="bg-blue-200" colspan="2">{{(totalMPsemana0+totalEmpaque | number: '1.1-2')}}</td>
              <td style="min-width: 2rem; text-align: right;">{{ totalMPsemana0 | number : '1.1-2'}}</td>
              <td style="min-width: 2rem; text-align: right;">{{ totalEmpaque | number : '1.1-2'}}</td>
              <td class="bg-green-200" colspan="2">{{(totalMPsemana1+totalEmpaque | number: '1.1-2')}}</td>
              <td style="min-width: 2rem; text-align: right;">{{ totalMPsemana1 | number: '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ totalEmpaque | number : '1.1-2'}}</td>
              <td class="bg-yellow-200" colspan="2">{{(totalMPsemana2+totalEmpaque | number: '1.1-2')}}</td>
              <td style="min-width: 2rem; text-align: right;">{{ totalMPsemana2 | number: '1.1-2' }}</td>
              <td style="min-width: 2rem; text-align: right;">{{ totalEmpaque | number: '1.1-2' }}</td>

          </tr>
          <tr>
            
            <td style="min-width: 2rem; text-align: center;" colspan="6" >Merma</td>
            <td style="min-width: 2rem; text-align: center;"  >{{merma | number: '1.1-2'}}</td>
            <td style="min-width: 2rem; text-align: center;"  >{{merma*totalCostoPTSAP | number: '1.1-2'}}</td>
            <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ merma*(totalMPsemana0+totalEmpaque) | number: '1.1-2' }}</td>
            <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="6"></td>
            <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ merma*(totalMPsemana1+totalEmpaque) | number: '1.1-2' }}</td>
            <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="6"></td>
            <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ merma*(totalMPsemana2+totalEmpaque) | number: '1.1-2' }}</td>
            <td style="min-width: 2rem; text-align: center;" colspan="2" rowspan="6"></td>
        </tr>

        <tr>
            
            <td style="min-width: 2rem; text-align: center;" colspan="6">Costo</td>
            <td style="min-width: 2rem; text-align: center;"  >{{merma+totalCantidadArticulos | number: '1.1-2'}}</td>
            <td style="min-width: 2rem; text-align: center;"  >{{(merma*totalCostoPTSAP)+totalCostoPTSAP | number: '1.1-2'}}</td>
            <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ (merma*(totalMPsemana0+totalEmpaque))+(totalMPsemana0+totalEmpaque) | number: '1.1-2' }}</td>
            <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ (merma*(totalMPsemana1+totalEmpaque))+(totalMPsemana1+totalEmpaque) | number: '1.1-2' }}</td>
            <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ (merma*(totalMPsemana2+totalEmpaque))+(totalMPsemana2+totalEmpaque) | number: '1.1-2' }}</td>
        </tr>
          <tr>
              
              <td style="min-width: 2rem; text-align: center;" colspan="7" >Recurso</td>
              <td style="min-width: 2rem; text-align: center;">{{recursoPT | number: '1.1-2' }}</td>
              <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ recursoPT | number: '1.1-2' }}</td>
              <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ recursoPT | number: '1.1-2' }}</td>
              <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ recursoPT | number: '1.1-2' }}</td>
          </tr>
          <tr>
              <td style="min-width: 2rem; text-align: center;" colspan="7">Costo venta</td>
              <td style="min-width: 2rem; text-align: center;">{{ costoVentaPTSAP | number: '1.1-2' }}</td>
              <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoVentaPTsemana0 | number: '1.1-2' }}</td>
              <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoVentaPTsemana1 | number: '1.1-2' }}</td>
              <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoVentaPTsemana2 | number: '1.1-2' }}</td>
          </tr>

          <tr>
              <td style="min-width: 2rem; text-align: center;" colspan="7">Administración</td>
              <td style="min-width: 2rem; text-align: center;">{{ administracion | number: '1.1-2' }}</td>
              <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ administracion | number: '1.1-2' }}</td>
              <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ administracion | number: '1.1-2' }}</td>
              <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ administracion | number: '1.1-2' }}</td>
          </tr>

          <tr>
              <td style="min-width: 2rem; text-align: center;" colspan="7">Costo total</td>
              <td style="min-width: 2rem; text-align: center;">{{ costoTotalPTSAP | number: '1.1-2' }}</td>
              <td class="bg-blue-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoTotalPTsemana0 | number: '1.1-2' }}</td>
              <td class="bg-green-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoTotalPTsemana1 | number: '1.1-2' }}</td>
              <td class="bg-yellow-200" style="min-width: 2rem; text-align: center;" colspan="2">{{ costoTotalPTsemana2 | number: '1.1-2' }}</td>
          </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
          <tr>
              <td colspan="16" class="text-center">No se econtraron materias primas asociadas al producto terminado seleccionado.</td>
          </tr>
      </ng-template>
      <ng-template pTemplate="loadingbody">
          <tr>
              <td colspan="16" class="text-center">Cargando materias primas asociadas al producto terminado. Por favor espere</td>
          </tr>
      </ng-template>
  </p-table>
  
</div>

<!-- Fin detalle de materia prima-->


</ng-template>
<ng-template pTemplate="footer">
<p-button   icon="pi pi-check" 
          (onClick)="formCrreateDetalleCalculo=false"                     
          
          label="Cerrar"
          styleClass="p-button-text">
</p-button>
</ng-template>
</p-dialog>
<!---Fin dialog Form detalle -->

<!---Dilalog FORM parametros globales-->
<p-dialog header="Parametros gobales calculadora" 
[(visible)]="formParametrosG" 
[modal]="true"
[breakpoints]="{'960px': '75vw', '640px': '100vw'}" 
[style]="{width: '50vw'}" 
[maximizable]="true"
[draggable]="false" 
[resizable]="false">

<ng-template pTemplate="content">

<!-- Detalle de materia prima-->


<div class="card p-10">
  
    <div class="grid">
        <div class="col-12">
            <div class="card p-fluid">
                <!-- TABLA DE PARAMETROS CALCULADORA-->                
                <div class="grid">
                    <div class="field col">
                        <p-table #dt3 
                        [value]="parametros" 
                        [rowHover]="true"
                        styleClass="p-datatable-gridlines p-datatable-sm" 
                        responsiveLayout="scroll">
                        <ng-template pTemplate="caption">
                            <div class="flex justify-content-between flex-column sm:flex-row">
                                <div>
                                    <h4>Parametros costo materia prima nacionalizada</h4> 
                                </div>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="header">
                            
                            <tr>
                                <th class="surface-200 text-center"><div class="text-center">Id</div></th>
                                <th class="surface-200 text-left"><div class="text-left">Descripción</div></th>
                                <th class="surface-200 text-center"><div class="text-center">Valor</div></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-parametro>
                            <tr>
                                
                                <td style="min-width: 2rem; width: 2rem; text-align: center;">{{ parametro.id }}</td>
                                <td style="min-width: 10rem; text-align: left;">{{ parametro.parametro }}</td>
            
                                

                                <td pEditableColumn style="width: 8rem; text-align: right;">
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input pInputText 
                                                   type="number" 
                                                   class="w-full"
                                                   
                                                   [(ngModel)]="parametro.valor"
                                                   (keydown.enter)="PresionaEnter($event)"
                                                   (blur)="cambio($event)">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ parametro.valor | number : '1.1-2'}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                
                            </tr>
                       
                        </ng-template>
                       
                      
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="16" class="text-center">No se econtraron parametros.</td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="loadingbody">
                            <tr>
                                <td colspan="16" class="text-center">Cargando parametros. Por favor espere</td>
                            </tr>
                        </ng-template>
                       
                </p-table>
                    </div>
                </div>
                <!-- TABLA DE COSTOS LOCALIDAD-->
                <div class="grid">
                    
                    <div class="field col">
                        <p-table #dt4 
                        [value]="costos_localidad" 
                        [rowHover]="true"
                        styleClass="p-datatable-gridlines p-datatable-sm" 
                        responsiveLayout="scroll">
                        <ng-template pTemplate="caption">
                            <div class="flex justify-content-between flex-column sm:flex-row">
                                <div>
                                    <h4>Costos por localidad</h4> 
                                </div>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="header">
                            
                            <tr>
                                <th class="surface-200 text-center"><div class="text-center">Id</div></th>
                                <th class="surface-200 text-left"><div class="text-left">Localidad</div></th>
                                <th class="surface-200 text-center"><div class="text-center">Administración</div></th>
                                <th class="surface-200 text-center"><div class="text-center">Recurso</div></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-costo_localidad>
                            <tr>
                                
                                <td style="min-width: 2rem; width: 2rem; text-align: center;">{{ costo_localidad.codigo }}</td>
                                <td style="min-width: 10rem; text-align: left;">{{ costo_localidad.localidad }}</td>
                                <td pEditableColumn style="width: 8rem; text-align: right;">
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input pInputText 
                                                   type="number" 
                                                   class="w-full"
                                                   
                                                   [(ngModel)]="costo_localidad.costo_admin"
                                                   (keydown.enter)="PresionaEnter($event)"
                                                   (blur)="cambio($event)">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{costo_localidad.costo_admin | number : '1.1-2'}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td pEditableColumn style="width: 8rem; text-align: right;">
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input pInputText 
                                                   type="number" 
                                                   class="w-full"
                                                   
                                                   [(ngModel)]="costo_localidad.costo_recurso"
                                                   (keydown.enter)="PresionaEnter($event)"
                                                   (blur)="cambio($event)">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{costo_localidad.costo_recurso | number : '1.1-2'}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <!--<td style="min-width: 2rem; text-align: center;">{{ costo_localidad.costo_admin | number }}</td>
                                <td style="min-width: 2rem; text-align: center;">{{ costo_localidad.costo_recurso | number }}</td>-->
                                
                            </tr>
                       
                        </ng-template>
                       
                      
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="16" class="text-center">No se econtraron parametros.</td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="loadingbody">
                            <tr>
                                <td colspan="16" class="text-center">Cargando parametros. Por favor espere</td>
                            </tr>
                        </ng-template>
                       
                </p-table>
                    </div>
                </div>
                <!-- TABLA DE PRESENTACION PRODUCTOS-->
                <div class="grid">
                    
                    <div class="field col">
                        <p-table #dt5 
                        [value]="presentacion_items" 
                        [rowHover]="true"
                        styleClass="p-datatable-gridlines p-datatable-sm" 
                        responsiveLayout="scroll">
                        <ng-template pTemplate="caption">
                            <div class="flex justify-content-between flex-column sm:flex-row">
                                <div>
                                    <h4>Tipo de presentación producto</h4> 
                                </div>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="header">
                            
                            <tr>
                                <th class="surface-200 text-center"><div class="text-center">Id</div></th>
                                <th class="surface-200 text-left"><div class="text-left">Descripción</div></th>
                                <th class="surface-200 text-center"><div class="text-center">Presentación</div></th>
                                <th class="surface-200 text-center"><div class="text-center">Valor</div></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-presentacion_item>
                            <tr>
                                
                                <td style="min-width: 2rem; width: 2rem; text-align: center;">{{ presentacion_item.id }}</td>
                                <td style="min-width: 10rem; text-align: left;">{{ presentacion_item.descripcion }}</td>
                                <td style="min-width: 2rem; text-align: center;">{{ presentacion_item.presentacion | number }}</td>
                                <td pEditableColumn style="width: 8rem; text-align: right;">
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input pInputText 
                                                   type="number" 
                                                   class="w-full"
                                                   
                                                   [(ngModel)]="presentacion_item.valor"
                                                   (keydown.enter)="PresionaEnter($event)"
                                                   (blur)="cambio($event)">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{ presentacion_item.valor | number : '1.1-2'}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                
                            </tr>
                       
                        </ng-template>
                       
                      
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="16" class="text-center">No se econtraron parametros.</td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="loadingbody">
                            <tr>
                                <td colspan="16" class="text-center">Cargando parametros. Por favor espere</td>
                            </tr>
                        </ng-template>
                       
                </p-table>
                    </div>
                </div>



            </div>
        </div>
    </div>
  
</div>

<!-- Fin detalle de materia prima-->


</ng-template>
<ng-template pTemplate="footer">
    <p-button   icon="pi pi-save" 
                (onClick)="grabarCambiosParametros()"                     
                
                label="Guardar"
                styleClass="p-button-text">
</p-button>
<p-button   icon="pi pi-check" 
            (onClick)="formParametrosG=false"                     
          
          label="Cerrar"
          styleClass="p-button-text">
</p-button>
</ng-template>
</p-dialog>
<!---Fin dialog Form detalle -->

<!-- Dialog loading -->
<p-dialog header="Cargando" [(visible)]="displayModal" [modal]="true" [style]="{width: '50vw'}" [draggable]="false" [resizable]="false">
    <p class="m-0">

    </p>

    <div *ngIf="loadingCargue" class="field col">
                    
        <p-progressBar mode="indeterminate" [style]="{'height': '6px'}"></p-progressBar>
    </div>
</p-dialog>
<!--Fin Dialog loading-->