<p-toast></p-toast>
<app-breadcrumb [urlBreadCrumb]="urlBreadCrumb"></app-breadcrumb>
<!-- Cabecera solped -->
<div class="grid">
    <div class="col-12">
        <div class="card p-fluid">
            <div class="grid">
                <div class="col">
                    <div class="field">
                        <label htmlFor="nombreusuario">Nombre solicitante</label>
                        <input pInputText 
                                [(ngModel)]="infoUsuario.fullname" 
                                id="nombreusuario" 
                                name="nombreusuario" 
                                class="p-inputtext-sm"
                                type="text"
                                required 
                                readonly/>
                    </div>
                    <div class="field">
                        <label htmlFor="area">Área aprobación</label>
                        <p-dropdown [options]="areas" 
                                    optionLabel="area" 
                                    optionValue="area"
                                    [(ngModel)]="area" id="area" name="area" placeholder="Área"
                                    [required]="true"
                                    styleClass="p-dropdown-sm "
                                    [readonly]="lineasSolped.length > 0"
                                    (onChange)="SeleccionarArea()"
                                    [ngClass]="{'ng-invalid ng-dirty' : (envioFormulario && !area) || (nuevaLinea && !area)}">
                        </p-dropdown>
                    </div>
                    <div class="field">
                        <label htmlFor="clase">Clase</label>
                        <p-dropdown [options]="clases" 
                                    optionLabel="name" 
                                    optionValue="code"
                                    [(ngModel)]="clase" 
                                    id="clase" 
                                    name="clase"
                                    (onChange)="SeleccionarClase()" 
                                    placeholder="Clase solped"
                                    styleClass="p-dropdown-sm "
                                    [disabled]="serieName === 'SPB'" 
                                    [required]="true" 
                                    [readonly]="lineasSolped.length > 0"
                                    [ngClass]="{'ng-invalid ng-dirty' : (envioFormulario && !clase) || (nuevaLinea && !clase)}">
                        </p-dropdown>
                    </div>
                </div>
                <div class="col">
                    <div class="flex">
                        <div class="field">
                            <label htmlFor="serie">Tipo</label>
                            <p-dropdown [options]="series" 
                                        optionLabel="name" optionValue="code"
                                        [(ngModel)]="serie" 
                                        [readonly]="lineasSolped.length > 0" 
                                        id="serie"
                                        name="serie" 
                                        placeholder="Tipo"
                                        styleClass="w-full p-dropdown-sm p-inputtext-sm" 
                                        [required]="true" 
                                        (onChange)="SeleccionarSerie()"
                                        [ngClass]="{'ng-invalid ng-dirty' : (envioFormulario && !serie) || (nuevaLinea && !serie)}">
                            </p-dropdown>
                        </div>
                        <div class="field">
                            <label htmlFor="codigoSap">Código SAP</label>
                            <input pInputText 
                                    [(ngModel)]="codigoSap" 
                                    id="codigoSap" 
                                    name="codigoSap"
                                    class="p-inputtext-sm"
                                    styleClass="w-full " 
                                    type="text" required readonly />
                        </div>
                    </div>
                    <div class="flex">
                        <div class="field">
                            <label for="fechaContable">Fecha contable</label>
                            <p-calendar [(ngModel)]="fechaContable" 
                                        (onSelect)="SeleccionarFechaContable()" 
                                        [showIcon]="true"
                                        inputId="fechaContable" 
                                        [required]="true"
                                        styleClass="p-calendar-sm p-inputtext-sm" 
                                        [readonlyInput]="lineasSolped.length > 0"
                                        dateFormat="dd/mm/yy"
                                        [ngClass]="{'ng-invalid ng-dirty' : (envioFormulario && !fechaContable) || (nuevaLinea && !fechaContable)}">
                            </p-calendar>
                        </div>

                        <div class="field">
                            <label for="fechaCaducidad">Válido hasta</label>
                            <p-calendar [(ngModel)]="fechaCaducidad" 
                                        [showIcon]="true" 
                                        inputId="fechaCaducidad"
                                        [required]="true"
                                        styleClass="p-calendar-sm p-inputtext-sm"
                                        dateFormat="dd/mm/yy"
                                        [ngClass]="{'ng-invalid ng-dirty' : (envioFormulario && !fechaCaducidad) || (nuevaLinea && !fechaCaducidad)}">
                            </p-calendar>
                        </div>

                    </div>
                    <div class="flex">
                        <div class="field">
                            <label for="fechaDocumento">Fecha documento</label>
                            <p-calendar [(ngModel)]="fechaDocumento" 
                                        [showIcon]="true" 
                                        inputId="fechaDocumento"
                                        [required]="true"
                                        styleClass="p-calendar-sm p-inputtext-sm"
                                        dateFormat="dd/mm/yy"
                                        [ngClass]="{'ng-invalid ng-dirty' : (envioFormulario && !fechaDocumento) || (nuevaLinea && !fechaDocumento)}">
                            </p-calendar>
                        </div>

                        <div class="field">
                            <label for="fechaNecesidad">Fecha necesaria</label>
                            <p-calendar [(ngModel)]="fechaNecesidad" 
                                        [showIcon]="true" 
                                        inputId="fechaNecesidad"
                                        styleClass="p-calendar-sm p-inputtext-sm"
                                        [required]="true"
                                        dateFormat="dd/mm/yy"
                                        [ngClass]="{'ng-invalid ng-dirty' : (envioFormulario && !fechaNecesidad) || (nuevaLinea && !fechaNecesidad)}">
                            </p-calendar>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid">
                <div class="col">
                    <div class="field">
                        <label htmlFor="comentarios">Mes real del gasto</label>
                        <p-dropdown [options]="meses" 
                                    optionLabel="fullname" 
                                    optionValue="fullname"
                                    [(ngModel)]="U_NF_MES_REAL" 
                                    id="U_NF_MES_REAL" 
                                    name="U_NF_MES_REAL"
                                    placeholder="Mes real del gasto"
                                    styleClass="p-dropdown-sm "
                                    [required]="true" 
                                    [readonly]="lineasSolped.length > 0">
                                    <ng-template pTemplate="selectedItem">
                                        {{U_NF_MES_REAL | titlecase}}
                                    </ng-template>
                                    <ng-template let-mes pTemplate="mes">
                                        {{mes.fullname | titlecase }}
                                    </ng-template>
                                    
                        </p-dropdown>
                        
                    </div>
                </div>
            </div>

            <div class="grid">
                <div class="col">
                    <div class="field">
                        <label htmlFor="comentarios">Comentarios</label>
                        <textarea rows="3" 
                                  pInputTextarea
                                  [(ngModel)]="comentarios"
                                  class="w-full"
                                  id="comments"
                                  maxlength="200">
                        </textarea>
                        
                    </div>
                </div>
            </div>
            <p-divider></p-divider>
            <div class="grid">
                <div class="col">
                    <div class="grid align-content-center">
                        <div  *ngIf="lineasSolped.length==0" class="field col">
                            <button pButton 
                                    label="Importar detalle" 
                                    (click)="importarCSV()"
                                    class="p-button-outlined mb-2 p-button-warning p-button-sm"
                                    [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || (solpedAprobada !=='N' && solpedAprobada !=='R')" 
                                    icon="pi pi-list">
                            </button>
                        </div>
                        <div class="field col">
                            <button pButton 
                                    label="Nueva Línea" 
                                    (click)="AdicionarLinea()"
                                    class="p-button-outlined mb-2 p-button-warning p-button-sm"
                                    [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || (solpedAprobada !=='N' && solpedAprobada !=='R')" 
                                    icon="pi pi-list">
                            </button>
                        </div>
                        <div *ngIf="lineasSolped.length>0" class="field col">
                            <p-button label="Ver Detalle" 
                                      icon="pi pi-search" 
                                      (onClick)="MostrarDetalle()"
                                      [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].read_accion"
                                      styleClass="p-button-outlined mb-2 p-button-secondary p-button-sm"
                                      [badge]="lineasSolped.length.toString()" 
                                      badgeClass="p-badge-danger"></p-button>
                        </div>
                        <div class="field col">
                            <p-button label="Anexos" 
                                      icon="pi pi-list" 
                                      (onClick)="verAnexos()"
                                      [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || (solpedAprobada !=='N' && solpedAprobada !=='R')"
                                      styleClass="p-button-outlined mb-2 p-button-primary p-button-sm"
                                      [badge]="anexosSolped.length.toString()" 
                                      badgeClass="p-badge-danger"></p-button>

                            <!--<button pButton 
                                    label="Anexos" 
                                    (click)="verAnexos()"
                                    class="p-button-outlined mb-2 p-button-primary p-button-sm"
                                    [badge]="anexosSolped.length.toString()" 
                                    [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || (solpedAprobada !=='N' && solpedAprobada !=='R')" 
                                    icon="pi pi-list">
                            </button>-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- fin cabecera solped -->
<!--Footer solped-->
<div class="grid">
    <div class="col-12">
        <div class="card p-fluid">
            <div class="grid">
                <div class="col">
                    <button pButton 
                            label="Guardar" 
                            (click)="GuardarSolped()" 
                            [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || registroSolped  || (solpedAprobada !=='N' && solpedAprobada !=='R')"  
                            class="p-button-outlined mb-2 p-button-success p-button-sm" 
                            icon="pi pi-save">
                    </button>
                </div>
                <div class="col">
                    <button pButton 
                            label="Nueva solped" 
                            (click)="NuevaSolped()" 
                            [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || !envioFormulario"
                            class="p-button-outlined mb-2 p-button-primary p-button-sm" 
                            icon="pi pi-list"></button>
                </div>
            </div>
        </div>
    </div>
</div>
<!--fin footer solped-->
<!---Dilalog FORM detalle-->
<p-dialog [header]="editarLinea ? 'Editar línea':'Adicionar Línea'" 
          [(visible)]="formularioLinea" 
          [modal]="true"
          [breakpoints]="{'960px': '75vw', '640px': '100vw'}" 
          [style]="{width: '50vw'}" 
          [maximizable]="true"
          [draggable]="false" 
          (onHide)="envioLinea= false" 
          [resizable]="false">

    <ng-template pTemplate="content">
        <!-- Grupo codigo item, descripción y fecha necesaria -->
        <div class="grid">
            <div class="field col">
                <label for="fechaRequerida">Fecha necesaria</label>
                <p-calendar [(ngModel)]="fechaRequerida" 
                            [showIcon]="true" 
                            inputId="fechaRequerida" 
                            [required]="true"
                            styleClass="w-full" 
                            [ngClass]="{'ng-invalid ng-dirty' : envioLinea && !fechaRequerida}">
                </p-calendar>
            </div>
            <div class="field col">
                <label for="proveedor">Proveedor</label>
                <p-autoComplete [(ngModel)]="proveedor" 
                                [showEmptyMessage]="true"
                                [suggestions]="proveedoresFiltrados" 
                                (completeMethod)="filtrarProveedores($event)" 
                                field="CardCode"
                                [minLength]="1" 
                                [delay]="1000" 
                                (onSelect)="SeleccionarProveedor()" 
                                panelStyleClass="text-sm sm:ml-2"
                                inputStyleClass="w-full" styleClass="w-full" inputId="proveedor2">

                    <ng-template let-proveedor pTemplate="item">
                        <div>{{proveedor.CardCode}} - {{proveedor.CardName}}</div>
                    </ng-template>

                </p-autoComplete>
            </div>
        </div>
        <div class="grid">
            <div class="field col">
                <label for="itemCode">Código ítem</label>
                <p-autoComplete [(ngModel)]="item" 
                                [showEmptyMessage]="true" 
                                [suggestions]="itemsFiltrados"
                                (completeMethod)="filtrarItems($event)" 
                                field="ItemCode" 
                                [minLength]="1" 
                                [delay]="1000"
                                (onSelect)="SeleccionarItemCode()" 
                                
                                (onClear)="clearItemCode()"
                                inputStyleClass="w-full" 
                                styleClass="w-full" 
                                inputId="itemCode" [autofocus]="true"
                                panelStyleClass="text-sm sm:ml-2" 
                                [disabled]="clase === 'S'"
                                [ngClass]="{'ng-invalid ng-dirty' : clase==='I' && envioLinea && !item.ItemCode}">

                    <ng-template let-item pTemplate="item">
                        <div>{{item.ItemCode}} - {{item.ItemName}}</div>
                    </ng-template>

                </p-autoComplete>
            </div>
            <div class="field col">
                <label for="descripcion">Descripción</label>
                <div class="p-inputgroup">
                    <input  pInputText 
                        [(ngModel)]="descripcion" 
                        id="descripcion" 
                        name="descripcion" 
                        type="text"
                        required 
                        maxlength="200"
                        class="w-full"
                        [ngClass]="{'ng-invalid ng-dirty' : envioLinea && !descripcion}" />
                        <span class="p-inputgroup-addon"><p-badge [value]="descripcion.length.toString()"></p-badge></span>
                </div>
                
            </div>

        </div>
        
        <!-- Grupo dependencias -->
        <div class="grid">
            <div class="field col">
                <label for="viceprecidencia">Vicepresidencia</label>
                <p-dropdown [options]="vicepresidencias" 
                            [(ngModel)]="viceprecidencia"
                            optionLabel="vicepresidency" 
                            [filter]="true" 
                            filterBy="vicepresidency" 
                            [showClear]="true"
                            placeholder="Seleccione una vicepresidencia" 
                            styleClass="w-full" 
                            inputId="viceprecidencia"
                            [ngClass]="{'ng-invalid ng-dirty' :  envioLinea && !viceprecidencia.vicepresidency}"
                            (onChange)="SeleccionarVicepresidencia()" #ocrcode3>

                    <ng-template pTemplate="selectedItem">
                        <div class="country-item country-item-value" *ngIf="viceprecidencia">

                            <div>{{viceprecidencia.vicepresidency}}</div>
                        </div>
                    </ng-template>
                    <ng-template let-viceprecidencia pTemplate="item">
                        <div class="country-item">

                            <div>{{viceprecidencia.vicepresidency}}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>
            <div class="field col">
                <label for="dependencia">Dependencia</label>
                <p-dropdown [options]="dependencias" 
                            [(ngModel)]="dependencia" 
                            optionLabel="dependence"
                            placeholder="Seleccione una dependencia" 
                            [filter]="true" 
                            filterBy="dependence" 
                            [showClear]="true"
                            styleClass="w-full" 
                            [ngClass]="{'ng-invalid ng-dirty' :  envioLinea && !dependencia.dependence}"
                            inputId="dependencia" 
                            (onChange)="SeleccionarDependencia()" #ocrcode2>

                    <ng-template pTemplate="selectedItem">
                        <div class="country-item country-item-value" *ngIf="dependencia">

                            <div>{{dependencia.dependence}}</div>
                        </div>
                    </ng-template>
                    <ng-template let-dependencia pTemplate="item">
                        <div class="country-item">

                            <div>{{dependencia.dependence}}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>
            <div class="field col">
                <label for="localidad">Localidad</label>
                <p-dropdown [options]="localidades" 
                            [(ngModel)]="localidad" 
                            optionLabel="location"
                            placeholder="Seleccione una localidad" 
                            [filter]="true" 
                            filterBy="location" 
                            [showClear]="true"
                            (onChange)="SeleccionarLocalidad()" 
                            styleClass="w-full"
                            [ngClass]="{'ng-invalid ng-dirty' :  envioLinea && !localidad.location}" 
                            inputId="localidad"
                            #ocrcode>

                    <ng-template pTemplate="selectedItem">
                        <div class="country-item country-item-value" *ngIf="localidad">

                            <div>{{localidad.location}}</div>
                        </div>
                    </ng-template>
                    <ng-template let-localidad pTemplate="item">
                        <div class="country-item">

                            <div>{{localidad.location}}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>
        </div>
        <!-- Proyecto-->    
        <div class="grid">
            <div class="field col">
                <label for="proyecto">Proyecto</label>
                <p-dropdown [options]="proyectos" 
                            [(ngModel)]="proyecto" 
                            optionLabel="PROYECTOFINANCIERO"
                        
                            placeholder="Seleccione un proyecto" 
                            [filter]="true" 
                            filterBy="PROYECTOFINANCIERO" 
                            [showClear]="true"
                            (onChange)="SeleccionarProyecto()"
                            styleClass="w-full" inputId="proyecto">

                    <ng-template pTemplate="selectedItem">
                        <div class="country-item country-item-value" *ngIf="proyecto">

                            <div>{{proyecto.PROYECTOFINANCIERO}}</div>
                        </div>
                    </ng-template>
                    <ng-template let-proyecto pTemplate="item">
                        <div class="country-item">

                            <div>{{proyecto.PROYECTOFINANCIERO}}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>

            <div class="field col">
                <label for="proyecto">Subproyecto</label>
                <p-dropdown [options]="subproyectos" 
                            [(ngModel)]="subproyecto" 
                            optionLabel="PROYECTOM"
                        
                            placeholder="Seleccione un subproyecto" 
                            [filter]="true" 
                            filterBy="PROYECTOM" 
                            [showClear]="true"
                            (onChange)="SeleccionarSubProyecto()"
                            styleClass="w-full" inputId="subproyecto"
                            [ngClass]="{'ng-invalid ng-dirty' :  envioLinea && subproyectos.length>0 && !subproyecto}">

                    <ng-template pTemplate="selectedItem">
                        <div class="country-item country-item-value" *ngIf="subproyecto">

                            <div>{{subproyecto.PROYECTOM | slice: 0:50}}</div>
                        </div>
                    </ng-template>
                    <ng-template let-subproyecto pTemplate="item">
                        <div class="country-item">

                            <div>{{subproyecto.PROYECTOM | slice: 0:50}}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>

            
        </div>
        <div class="grid">
            <div class="field col">
                <label for="proyecto">Etapa</label>
                <p-dropdown [options]="etapas" 
                            [(ngModel)]="etapa" 
                            optionLabel="ETAPA"
                        
                            placeholder="Seleccione una etapa" 
                            [filter]="true" 
                            filterBy="ETAPA" 
                            [showClear]="true"
                            (onChange)="SeleccionarEtapa()"
                            styleClass="w-full" inputId="etapa"
                            [ngClass]="{'ng-invalid ng-dirty' :  envioLinea && subproyectos.length>0 &&  !etapa}">

                    <ng-template pTemplate="selectedItem">
                        <div class="country-item country-item-value" *ngIf="etapa">

                            <div>{{etapa.ETAPA | slice: 0:100}}</div>
                        </div>
                    </ng-template>
                    <ng-template let-etapa pTemplate="item">
                        <div class="country-item">

                            <div>{{etapa.ETAPA | slice: 0:100}}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>
            <div class="field col">
                <label for="proyecto">Actividad</label>
                <p-dropdown [options]="actividades" 
                            [(ngModel)]="actividad" 
                            optionLabel="ACTIVIDAD"
                        
                            placeholder="Seleccione una etapa" 
                            [filter]="true" 
                            filterBy="ACTIVIDAD" 
                            [showClear]="true"
                            (onChange)="SeleccionarActividad()"
                            styleClass="w-full" inputId="ACTIVIDAD"
                            [ngClass]="{'ng-invalid ng-dirty' :  envioLinea && subproyectos.length>0 && !actividad}">

                    <ng-template pTemplate="selectedItem">
                        <div class="country-item country-item-value" *ngIf="actividad">

                            <div>{{actividad.ACTIVIDAD | slice: 0:100}}</div>
                        </div>
                    </ng-template>
                    <ng-template let-actividad pTemplate="item">
                        <div class="country-item">

                            <div>{{actividad.ACTIVIDAD | slice: 0:100}}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>
        </div>
        <!-- Fin proyectos -->
        <!--Almacen-->
        <div class="grid">
            <div class="field col">
                <label for="almacen">Almacen</label>
                <p-dropdown [options]="almacenes" 
                            [(ngModel)]="almacen" 
                            optionLabel="label"
                        
                            placeholder="Seleccione una almacen" 
                            [filter]="true" 
                            filterBy="label" 
                            [showClear]="true"
                            (onChange)="SeleccionarAlmacen()"
                            styleClass="w-full" inputId="almacen">

                    <ng-template pTemplate="selectedItem">
                        <div class="country-item country-item-value" *ngIf="almacen">

                            <div>{{almacen.label}}</div>
                        </div>
                    </ng-template>
                    <ng-template let-almacen pTemplate="item">
                        <div class="country-item">

                            <div>{{almacen.label}}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>
        </div>
        <!-- Grupo cuenta mayor -->
        <div class="grid">

            <div class="field col">
                <label for="cuenta">Cuenta Mayor</label>
                <p-autoComplete [(ngModel)]="cuenta" 
                                [showEmptyMessage]="true"
                                [suggestions]="cuentasFiltradas" 
                                (completeMethod)="filtrarCuentas($event)" 
                                field="Code"
                                [minLength]="1" 
                                [delay]="1000" 
                                (onSelect)="SeleccionarCuenta()" 
                                inputStyleClass="w-full"
                                styleClass="w-full" 
                                inputId="cuenta" 
                                panelStyleClass="text-sm sm:ml-2"
                                [disabled]="!validaCuenta"
                                [ngClass]="{'ng-invalid ng-dirty' : envioLinea && !cuenta.Code && validaCuenta}">

                    <ng-template let-cuenta pTemplate="item">
                        <div>{{cuenta.Code}} - {{cuenta.Name}}</div>
                    </ng-template>

                </p-autoComplete>
            </div>
            <div class="field col">
                <label for="nombreCuenta">Nombre cuenta</label>
                <input type="text" 
                        pInputText 
                        [(ngModel)]="nombreCuenta" 
                        id="nombreCuenta" 
                        disabled
                        class="w-full"
                        [ngClass]="{'ng-invalid ng-dirty' : envioLinea && !nombreCuenta && validaCuenta}">

            </div>
        </div>
        
        <!-- Grupo cantidad , precio y subtotal linea -->
        <div class="grid">

            <div class="field col">
                <label for="cantidad">Cantidad</label>
                <input  pInputText 
                        [(ngModel)]="cantidad" 
                        type="number" 
                        id="cantidad" 
                        placeholder="Cantidad"
                        required (change)="calcularSubtotalLinea()" 
                        class="w-full"
                        [ngClass]="{'ng-invalid ng-dirty' : envioLinea && !cantidad}">
            </div>
            <div class="field col">
                <label for="precio">Precio</label>
                <div class="flex">

                    <p-dropdown [options]="monedas" 
                                optionLabel="Currency" 
                                optionValue="Currency"
                                [(ngModel)]="moneda" 
                                id="moneda" 
                                name="moneda" 
                                [required]="true"
                                [readonly]="lineasSolped.length>0"
                                (onChange)="SeleccionarMoneda()">
                    </p-dropdown>
                    <p-inputNumber  [(ngModel)]="precio" 
                                    inputId="precio" 
                                    mode="currency" 
                                    currency="COP"
                                    locale="es-CO" 
                                    placeholder="Precio" 
                                    (ngModelChange)="calcularSubtotalLinea()"
                                    [ngStyle]="{width: '100%' }" styleClass="w-full"
                                    [ngClass]="{'ng-invalid ng-dirty' : envioLinea && !precio}">
                    </p-inputNumber>
                </div>

            </div>
            <div class="field col">
                <label for="subtotalLinea">Subtotal línea</label>
                <p-inputNumber  [(ngModel)]="subtotalLinea" 
                                inputId="subtotalLinea" 
                                mode="currency" 
                                currency="COP"
                                locale="es-CO" placeholder="" 
                                [ngStyle]="{width: '100%' }" 
                                styleClass="w-full" 
                                [readonly]="true"
                                [ngClass]="{'ng-invalid ng-dirty' : envioLinea && !subtotalLinea}">
                </p-inputNumber>

            </div>
        </div>

        <div class="grid">

            <div class="field col">
                <label for="impuesto">Impuesto</label>
                <div class="flex">
                    <p-dropdown [options]="impuestos" 
                                [(ngModel)]="impuesto" 
                                optionLabel="Code"
                                placeholder="Seleccione un impuesto" 
                                [filter]="true" 
                                filterBy="Code" [showClear]="true"
                                class="w-full" styleClass="w-full"
                                [ngClass]="{'ng-invalid ng-dirty' : envioLinea && !impuesto}" 
                                inputId="impuesto"
                                (onChange)="SeleccionarImpuesto()">

                        <ng-template pTemplate="selectedItem">
                            <div class="country-item country-item-value" *ngIf="impuesto">

                                <div>{{impuesto.Code}}</div>
                            </div>
                        </ng-template>
                        <ng-template let-impuesto pTemplate="item">
                            <div class="country-item">

                                <div>{{impuesto.Code}} - {{impuesto.Name}}</div>
                            </div>
                        </ng-template>
                    </p-dropdown>
                    <p-inputNumber  [(ngModel)]="prcImpuesto" 
                                    suffix="%" 
                                    [readonly]="true" 
                                    inputStyleClass="text-center w-6"
                                    styleClass="text-center" 
                                    [disabled]="true"
                                    [ngClass]="{'ng-invalid ng-dirty' : envioLinea && !prcImpuesto}">
                    </p-inputNumber>

                </div>

            </div>

            <div class="field col">
                <label for="valorImpuesto">Valor impuesto</label>
                <p-inputNumber  [(ngModel)]="valorImpuesto" 
                                inputId="valorImpuesto" 
                                mode="currency" 
                                currency="COP"
                                locale="es-CO" 
                                placeholder="" 
                                class="w-full" 
                                [ngStyle]="{width: '100%' }" 
                                styleClass="w-full"
                                [readonly]="true" [disabled]="true"
                                [ngClass]="{'ng-invalid ng-dirty' : envioLinea && !valorImpuesto}">
                </p-inputNumber>

            </div>

            <div class="field col">
                <label for="totalLinea">Total linea</label>
                <p-inputNumber  [(ngModel)]="totalLinea" 
                                inputId="totalLinea" 
                                mode="currency" 
                                currency="COP"
                                locale="es-CO" 
                                placeholder="" 
                                [disabled]="true" 
                                class="w-full" 
                                styleClass="w-full" 
                                [readonly]="true"
                                [ngClass]="{'ng-invalid ng-dirty' : envioLinea && !totalLinea}">
                </p-inputNumber>

            </div>

        </div>



    </ng-template>
    <ng-template pTemplate="footer">
        <p-button   icon="pi pi-check" 
                    (onClick)="RegistrarLinea()"                     
                    [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion " 
                    label="Ok"
                    styleClass="p-button-text">
        </p-button>
    </ng-template>
</p-dialog>
<!---Fin dialog Form detalle -->

<!---Dialog lista detalle Solped-->

<p-dialog header="Detalle de la solicitud de pedido" 
          [(visible)]="listadoLineas" 
          [modal]="true" 
          [style]="{width: '50vw'}"
          [maximizable]="true" 
          [draggable]="false" 
          [resizable]="false">


    <p-table #dt1 
            [value]="lineasSolped" 
            dataKey="linenum" 
            [rows]="10" 
            [loading]="loading" 
            [rowHover]="true"
            styleClass="p-datatable-gridlines p-datatable-sm" 
            [paginator]="true"
            [globalFilterFields]="['itemcode','dscription','linevendor','acctcodename','acctcode','ocrcode','ocrcode2','ocrcode3']"
            selectionMode="multiple" 
            [(selection)]="lineaSeleccionada" responsiveLayout="scroll">
        <ng-template pTemplate="caption">
            <div class="flex justify-content-between flex-column sm:flex-row">
                <div>
                    <button pButton 
                            label="Limpiar" 
                            class="p-button-outlined mb-2 mr-2 p-button-sm" 
                            icon="pi pi-filter-slash"
                            (click)="clear(dt1)">
                    </button>
                    <button pButton 
                            label="Nueva Línea" 
                            (click)="AdicionarLinea()"
                            [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || (solpedAprobada !=='N' && solpedAprobada !=='R')" 
                            class="p-button-outlined mb-2  mr-2 p-button-warning p-button-sm" 
                            icon="pi pi-list">
                    </button>
                    <button pButton 
                            [label]="permisosUsuarioPagina.length>0 && permisosUsuarioPagina[0].create_accion?'Editar Línea':'Consultar'" 
                            class="p-button-outlined mb-2 mr-2 p-button-secondary p-button-sm"
                            icon="pi pi-pencil" 
                            (click)="EditarLinea()"
                            [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || !lineaSeleccionada || lineaSeleccionada.length!=1 || (solpedAprobada !=='N' && solpedAprobada !=='R')">
                    </button>
                    <button pButton 
                            label="Borrar Línea" 
                            class="p-button-outlined mb-2 mr-2 p-button-danger p-button-sm"
                            icon="pi pi-trash"
                            [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || !lineaSeleccionada || lineaSeleccionada.length==0 || (solpedAprobada !=='N' && solpedAprobada !=='R')"  
                            (click)="BorrarLineas()">
                    </button>
                </div>



                <span class="p-input-icon-left mb-2">
                    <i class="pi pi-search"></i>
                    <input pInputText 
                           type="text" 
                           #filter 
                           (input)="onGlobalFilter(dt1, $event)"
                           placeholder="Buscar por palabra clave" 
                           class="w-full p-inputtext-sm" />
                </span>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 3rem">
                    <!--<p-tableHeaderCheckbox></p-tableHeaderCheckbox>-->
                </th>
                <th>
                    <div class="flex justify-content-between align-items-center">
                        Línea detalle
                        <p-columnFilter type="text" field="linenum" display="menu"
                            placeholder="Buscar por linea detalle"></p-columnFilter>
                    </div>
                </th>
                <th>
                    <div class="flex justify-content-between align-items-center">
                        Código Ítem
                        <p-columnFilter type="text" field="itemcode" display="menu"
                            placeholder="Buscar por código item"></p-columnFilter>
                    </div>
                </th>
                <th>
                    <div class="flex justify-content-between align-items-center">
                        Descripción
                        <p-columnFilter type="text" field="dscription" display="menu"
                            placeholder="Buscar por descripción"></p-columnFilter>
                    </div>
                </th>

                <th>
                    <div class="flex justify-content-between align-items-center">
                        Fecha requerida
                    </div>
                </th>

                <th>
                    <div class="flex justify-content-between align-items-center">
                        Proveedor
                        <p-columnFilter type="text" field="linevendor" display="menu"
                            placeholder="Buscar por proveedor"></p-columnFilter>
                    </div>
                </th>

                <th>
                    <div class="flex justify-content-between align-items-center">
                        Cuenta Mayor
                        <p-columnFilter type="text" field="acctcode" display="menu" placeholder="Buscar por cuenta">
                        </p-columnFilter>
                    </div>
                </th>

                <th>
                    <div class="flex justify-content-between align-items-center">
                        Vicepresidencia
                        <p-columnFilter type="text" field="ocrcode3" display="menu"
                            placeholder="Buscar por vicepresidencia"></p-columnFilter>
                    </div>
                </th>

                <th>
                    <div class="flex justify-content-between align-items-center">
                        Dependencia
                        <p-columnFilter type="text" field="orecode2" display="menu"
                            placeholder="Buscar por dependencia"></p-columnFilter>
                    </div>
                </th>

                <th>
                    <div class="flex justify-content-between align-items-center">
                        Localidad
                        <p-columnFilter type="text" field="location" display="menu" placeholder="Buscar por localidad">
                        </p-columnFilter>
                    </div>
                </th>
                <th>
                    <div class="flex justify-content-between align-items-center">
                        Cantidad

                    </div>
                </th>
                <th>
                    <div class="flex justify-content-between align-items-center">
                        Precio

                    </div>
                </th>
                <th>
                    <div class="flex justify-content-between align-items-center">
                        Impuesto

                    </div>
                </th>
                <th>
                    <div class="flex justify-content-between align-items-center">
                        Valor Impuesto

                    </div>
                </th>
                <th>
                    <div class="flex justify-content-between align-items-center">
                        Subtotal línea

                    </div>
                </th>

                <th>
                    <div class="flex justify-content-between align-items-center">
                        Total línea

                    </div>
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-solpeditem>
            <tr>
                <td>
                    <p-tableCheckbox [value]="solpeditem" (onClick)="SeleccionarLinea()"></p-tableCheckbox>
                </td>
                <td style="min-width: 12rem;">
                    {{ solpeditem.linenum }}
                </td>
                <td style="min-width: 12rem;">
                    {{ solpeditem.itemcode }}
                </td>
                <td style="min-width: 12rem;">
                    {{ solpeditem.dscription }}
                </td>

                <td style="min-width: 12rem;">
                    {{ solpeditem.reqdatedet | date}}
                </td>

                <td style="min-width: 12rem;">
                    {{ solpeditem.linevendor }}
                </td>

                <td style="min-width: 12rem;">
                    {{ solpeditem.acctcode }}
                </td>
                <td style="min-width: 12rem;">
                    {{ solpeditem.ocrcode3}}
                </td>
                <td style="min-width: 12rem;">
                    {{ solpeditem.ocrcode2 }}
                </td>
                <td style="min-width: 12rem;">
                    {{ solpeditem.ocrcode }}
                </td>
                <td style="min-width: 12rem;">
                    {{ solpeditem.quantity }}
                </td>
                <td style="min-width: 12rem;">
                    {{ solpeditem.price | currency: solpeditem.moneda }}
                </td>
                <td style="min-width: 12rem;">
                    {{ solpeditem.tax }} {{ (solpeditem.linegtotal/solpeditem.linetotal)-1 |percent }}
                </td>
                <td style="min-width: 12rem;">
                    {{ solpeditem.taxvalor | currency :'COP'}}
                </td>
                <td style="min-width: 12rem;">
                    {{ solpeditem.linetotal | currency :'COP'}}
                </td>

                <td style="min-width: 12rem;">
                    {{ solpeditem.linegtotal | currency: 'COP' }}
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="footer">
            <tr>
                <td colspan="13" class="text-right">Total</td>
                <td>{{totalimpuestos | currency: 'COP'}}</td>
                <td>{{subtotal | currency: 'COP'}}</td>

                <td>{{grantotal | currency: 'COP'}}</td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="16" class="text-center">No se econtraron lineas asociadas a la solped.</td>
            </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody">
            <tr>
                <td colspan="16" class="text-center">Cargando solicitudes de pedido. Por favor espere</td>
            </tr>
        </ng-template>
    </p-table>


    <ng-template pTemplate="footer">
        <p-button icon="pi pi-check" (onClick)="listadoLineas=false" label="Ok" styleClass="p-button-text"></p-button>
    </ng-template>
</p-dialog>
<!---Fin Lista detalle Solped -->

<!---Dialog lista detalle anexos Solped-->

<p-dialog header="Anexos de la solicitud de pedido" 
          [(visible)]="listadoAnexos" 
          [modal]="true" 
          [style]="{width: '50vw'}"
          [maximizable]="true" 
          [draggable]="false" 
          [resizable]="false">


    <p-table #dt1 
            [value]="anexosSolped" 
            dataKey="file.name" 
            [rows]="10" 
            [loading]="loading" 
            [rowHover]="true"
            styleClass="p-datatable-gridlines p-datatable-sm" 
            [paginator]="true"
            [globalFilterFields]="['tipo','file.name','created_at']"
            selectionMode="multiple" 
            [(selection)]="lineaAnexoSeleccionada" responsiveLayout="scroll">
        <ng-template pTemplate="caption">
            <div class="flex justify-content-between flex-column sm:flex-row">
                <div>
                    <button pButton 
                            label="Limpiar" 
                            class="p-button-outlined mb-2 mr-2 p-button-sm" 
                            icon="pi pi-filter-slash"
                            (click)="clear(dt1)">
                    </button>
                    <button pButton 
                            label="Nuevo anexo" 
                            (click)="AdicionarAnexo()"
                            [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || (solpedAprobada !=='N' && solpedAprobada !=='R')" 
                            class="p-button-outlined mb-2  mr-2 p-button-warning p-button-sm" 
                            icon="pi pi-list">
                    </button>
                    
                    <button pButton 
                            label="Borrar anexo" 
                            class="p-button-outlined mb-2 mr-2 p-button-danger p-button-sm"
                            icon="pi pi-trash"
                            [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || !lineaAnexoSeleccionada || lineaAnexoSeleccionada.length==0 || (solpedAprobada !=='N' && solpedAprobada !=='R')"  
                            (click)="BorrarAnexo()">
                    </button>
                </div>



                <span class="p-input-icon-left mb-2">
                    <i class="pi pi-search"></i>
                    <input pInputText 
                           type="text" 
                           #filter 
                           (input)="onGlobalFilter(dt1, $event)"
                           placeholder="Buscar por palabra clave" 
                           class="w-full p-inputtext-sm" />
                </span>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 3rem">
                    <!--<p-tableHeaderCheckbox></p-tableHeaderCheckbox>-->
                </th>
                
                <th>
                    <div class="flex justify-content-between align-items-center">
                        Tipo
                        <p-columnFilter type="text" field="tipo" display="menu"
                            placeholder="Buscar por tipo anexo"></p-columnFilter>
                    </div>
                </th>
                <th>
                    <div class="flex justify-content-between align-items-center">
                        Nombre anexo
                        <p-columnFilter type="text" field="nombre" display="menu"
                            placeholder="Buscar por nombre"></p-columnFilter>
                    </div>
                </th>

                <th>
                    <div class="flex justify-content-between align-items-center">
                        Tamaño anexo
                        
                    </div>
                </th>

                <th *ngIf="solpedEditar" style="width: 1rem">
                    <div class="flex justify-content-between align-items-center">
                        
                        
                    </div>
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-anexossolped>
            <tr>
                <td>
                    <p-tableCheckbox [value]="anexossolped"></p-tableCheckbox>
                </td>
                
                <td style="min-width: 12rem;">
                    {{ anexossolped.tipo }}
                </td>
                <td style="min-width: 12rem;">
                  {{ anexossolped.file.name }}  
                </td>
                <td style="min-width: 12rem;">
                    {{ anexossolped.file.size }}
                </td>
                <td *ngIf="solpedEditar" style="min-width: 1rem;" class="flex justify-content-center flex-wrap">
                    <!--<i class="pi {{anexossolped.file.icon}} p-1" (click)="consultarAnexo(anexossolped.url)"></i>-->
                    <p-button icon="pi pi-download" label=""  pTooltip="Descargar" class="w-full" (onClick)="consultarAnexo3(anexossolped.url)"></p-button>
                </td>
                
            </tr>
        </ng-template>
        
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="16" class="text-center">No se econtraron anexos asociados a la solped.</td>
            </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody">
            <tr>
                <td colspan="16" class="text-center">Cargando anexos asociados a la solicitud de pedido. Por favor espere</td>
            </tr>
        </ng-template>
    </p-table>


    <ng-template pTemplate="footer">
        <p-button icon="pi pi-check" (onClick)="listadoAnexos=false" label="Ok" styleClass="p-button-text"></p-button>
    </ng-template>
</p-dialog>
<!---Fin Lista detalle Solped -->

<!---Dilalog FORM cargar anexos-->
<p-dialog header="Cargar anexo" 
          [(visible)]="formularioAnexo" 
          [modal]="true"
          [breakpoints]="{'960px': '75vw', '640px': '100vw'}" 
          [style]="{width: '50vw'}" 
          [maximizable]="true"
          [draggable]="false" 
          (onHide)="envioLinea= false" 
          [resizable]="false">

    <ng-template pTemplate="content">
        <div class="grid">
            <div class="field col">
                <label for="tipoanexo">Tipo anexo</label>
                <p-dropdown [options]="tiposanexo" 
                            [(ngModel)]="tipoanexo"
                            optionLabel="name" 
                            [filter]="true" 
                            filterBy="name" 
                            [showClear]="true"
                            placeholder="Seleccione el tipo del anexo" 
                            styleClass="w-full" 
                            inputId="tipoanexo"
                            [ngClass]="{'ng-invalid ng-dirty' :  (envioLineaanexo && !tipoanexo ) || (envioLineaanexo && tipoanexo=='')}"
                            (onChange)="seleccionarTipoAnexo()" #ocrcode3>

                    <ng-template pTemplate="selectedItem">
                        <div class="country-item country-item-value" *ngIf="tipoanexo">

                            <div>{{tipoanexo.name}}</div>
                        </div>
                    </ng-template>
                    <ng-template let-tipoanexo pTemplate="item">
                        <div class="country-item">

                            <div>{{tipoanexo.name}}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>
        </div>
        
        <div class="grid">
            <div class="field col">
                <p-fileUpload   name="demo[]" 
                                chooseLabel="Seleccionar"
                                cancelLabel="Cancelar"
                                accept=".pdf"
                                [multiple]="false" 
                                (onSelect)="onLoad($event)"
                                [showUploadButton]="false"
                                [maxFileSize]="50000000"
                                styleClass="w-full"
                                class="w-full"
                                [ngClass]="{'ng-invalid ng-dirty' :  (envioLineaanexo && !fileTmp ) || (envioLineaanexo && fileTmp=='')}"
                                [disabled]="!tipoanexo">
                                <ng-template pTemplate="content">
                                    <ul *ngIf="uploadedFiles.length">
                                        <li *ngFor="let file of uploadedFiles">{{file.name}} - {{file.size}} bytes</li>
                                    </ul>
                                </ng-template>
                </p-fileUpload>
                
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="footer">
        <p-button   icon="pi pi-check" 
                    (onClick)="adicionarlineaAnexo()"                     
                    [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion " 
                    label="Ok"
                    styleClass="p-button-text">
        </p-button>
    </ng-template>
</p-dialog>
<!---Fin dialog Form detalle -->


<!---Dilalog FORM  upload CSV detalle solpéd-->
<p-dialog header="Cargar detalle solped" 
          [(visible)]="formularioCSV" 
          [modal]="true"
          [breakpoints]="{'960px': '75vw', '640px': '100vw'}" 
          [style]="{width: '50vw'}" 
          [maximizable]="true"
          [draggable]="false" 
          (onHide)="loadingCargueCSV=false;" 
          [resizable]="false">

    <ng-template pTemplate="content">
        
        
        <div class="grid">
            <div class="field col">
                <p-fileUpload   name="demo2[]" 
                                chooseLabel="Seleccionar"
                                cancelLabel="Cancelar"
                                [multiple]="false" 
                                accept=".csv,.txt"
                                (onSelect)="onLoad2($event)"
                                [showUploadButton]="false"
                                [maxFileSize]="20000000"
                                
                                styleClass="w-full"
                                class="w-full"
                                [ngClass]="{'ng-invalid ng-dirty' :  !fileTmp2 }">
                                <ng-template pTemplate="content">
                                    <ul *ngIf="uploadedFiles2.length">
                                        <li *ngFor="let file of uploadedFiles2">{{file.name}} - {{file.size}} bytes</li>
                                    </ul>
                                </ng-template>
                </p-fileUpload>
                
                <div *ngIf="loadingCargueCSV" class="field col">
                    
                    <p-progressBar mode="indeterminate" [style]="{'height': '6px'}"></p-progressBar>
                </div>

                <div class="field col">
					<p>
						Para diligenciar correctamente la plantilla de cargue de la solped, siga las siguentes recomendaciones:
					   </p>
					   <p>
						Columna <strong>ITEM</strong>: El código del item debe existir en el maestro de SAP
					   </p>
					   <p>
						Columna <strong>DESCITEM</strong>: Es de caracter obligatorio, el número máximo de caracteres es de <strong>200</strong>
					   </p>
                       <p>
						Columna <strong>FECHAREQ</strong>: Debe ser una fecha valida
					   </p>
                       <p>
						Columna <strong>IDPROVEEDOR</strong>:El código del proveedor debe ser un codigo válido en SAP
					   </p>
                       <p>
						Columna <strong>IMPUESTO</strong>:El código del impuesto debe ser un codigo válido en SAP
					   </p>

                       <p>
						Columna <strong>VICEPRESIDENCIA</strong>:Es de caracter obligatorio, el código de la vicepresidencia debe ser un codigo válido en SAP y permitido para el usuario creador
					   </p>

                       <p>
						Columna <strong>DEPENDENCIA</strong>:Es de caracter obligatorio, el código de la dependencia debe ser un codigo válido en SAP y permitido para el usuario creador
					   </p>

                       <p>
						Columna <strong>LOCALIDAD</strong>:Es de caracter obligatorio, el código de la localidad debe ser un codigo válido en SAP y permitido para el usuario creador
					   </p>

                       <p>
						Columna <strong>ALMACEN</strong>:El código del almacen debe ser un codigo válido en SAP y permitido para el usuario creador
					   </p>

                       <p>
						Columna <strong>CODCUENTA</strong>:El código de la cuenta contable debe ser un codigo válido en SAP y permitido para el usuario creador
					   </p>

					   
					   
					   
				</div>
                
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="footer">
        <p-button   icon="pi pi-download" 
                    (onClick)="descargarCSV()"                     
                    
                    label="Descargar plantilla para solped"
                    styleClass="p-button-text">
        </p-button>
        <p-button   icon="pi pi-check" 
                    (onClick)="adicionarCSV()"                     
                    [disabled]="permisosUsuarioPagina.length==0 || !permisosUsuarioPagina[0].create_accion || !cargueValido" 
                    label="Ok"
                    styleClass="p-button-text">
        </p-button>
    </ng-template>
</p-dialog>
<!---Fin dialog Form detalle -->